@{
    Layout = null;
}
@model Yookey.WisdomClassed.SIP.Model.TempDetain.TempDetainInfoEntity
@using Yookey.WisdomClassed.SIP.Model.TempDetain
@using Yookey.WisdomClassed.SIP.Membership
@using Yookey.WisdomClassed.SIP.Model.Com
@using Yookey.WisdomClassed.SIP.Enumerate

@{
    List<TempDetainGoodsEntity> withholdArticleList = (List<TempDetainGoodsEntity>)ViewData["WithholdArticleList"];
    List<ComResourceEntity> articleTypeList = ViewBag.ArticleTypeList as List<ComResourceEntity>;
    List<ComResourceEntity> articleUnitIlist = ViewBag.ArticleUnitS as List<ComResourceEntity>;
    //审核过程
    List<TempDetainInfoProcessEntity> tempDetainInfoProcessList = (List<TempDetainInfoProcessEntity>)ViewData["TempDetainInfoProcessList"];


    var inStorage = this.Html.IsAllowed("InStorage");
    var hasReturned = this.Html.IsAllowed("HasReturned");
    var brigadeCancel = this.Html.IsAllowed("BrigadeCancel");
    var decayPriceless = this.Html.IsAllowed("DecayPriceless");
    var transferDept = this.Html.IsAllowed("TransferDept");
    
}
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>暂扣登记</title>
    <!--框架必需start-->
    <link  href="@Url.Content("~/Content/Styles/learunui-framework.css")" rel="stylesheet" />
    <script src="@Url.Content("~/Librarys/jquery/jquery-1.8.2.min.js")"></script>
    <script src="@Url.Content("~/Librarys/learunui-framework.js")"></script>
    <!--框架必需end-->
    <!--jqgrid表格组件start-->
    <script src="@Url.Content("~/Librarys/jqgrid/jquery-ui-custom.min.js")"></script>
    <script src="@Url.Content("~/Librarys/jqgrid/grid.locale-cn.js")"></script>
    <link  href="@Url.Content("~/Librarys/jqgrid/css/jqgrid.css")" rel="stylesheet" />
    <script src="@Url.Content("~/Librarys/jqgrid/jqGrid.js")"></script>
    <!--表格组件end-->

    <!--树形组件start-->
    <link href="@Url.Content("~/Librarys/tree/tree.css")" rel="stylesheet" />
    <script src="@Url.Content("~/Librarys/tree/tree.js")" type="text/javascript"></script>
    <!--树形组件end-->

    <!--布局组件start-->
    <script src="@Url.Content("~/Librarys/layout/splitter.js")"></script>
    <!--布局组件end-->

    <!--日期组件start-->
    <script src="@Url.Content("~/Librarys/datepicker/WdatePicker.js")"></script>
    <!--日期组件start-->

    <!--表单验证组件start-->
    <script src="@Url.Content("~/Librarys/validator/learunui-validator.js")"></script>
    <!--表单验证组件end-->
    <style type="text/css">
        .txtselect {
            height: 20px !important;
            width: 130px !important;
        }
    </style>


    <script type="text/javascript">

        $(document).ready(function () {
            Loading(false);
            var classNo = '@ViewBag.ClassNo';
            var legislationId = '@ViewBag.LegislationId';
            var legislationItemId = '@ViewBag.LegislationItemId';
            var legislationGistId = '@ViewBag.LegislationGistId';
            $("#ClassNo").val(classNo);
            ChangeClassNo(classNo, 'ItemActs', legislationId, legislationItemId, legislationGistId);
            ChangeTargetType($("#TargetType").val());
        });

        $(function () {
            BindCompany();
        });

        //绑定单位（大队）
        function BindCompany() {


            getAjax("@Url.Action("GetCompanyDropList", "Company", new { area = "CommonModule" })", { controlId: "drpCompany"}, function (cmsg) {
                eval(cmsg);
                BindDepartment();
            });
        }
        //绑定部门（中队）
        function BindDepartment() {

            var departmentId = '@Model.DepartmentId';
            getAjax("@Url.Action("GetDepartmentDropList", "Department", new { area = "CommonModule" })", { companyId: $("#drpCompany").val(), controlId: "drpDepartment", defaultSelId: departmentId }, function (dmsg) {
                eval(dmsg);

                BindUser(departmentId);
            });
        }

        //绑定人员
        function BindUser(departmentId) {
            getAjax("@Url.Action("GetUserDropList", "User", new { area = "CommonModule" })", { deptId: departmentId, controls: "RePersonelIdFist,RePersonelIdSecond" }, function (dmsg) {
                eval(dmsg);

                var firstUserId = '@Model.RePersonelIdFist';
                var secondUserId = '@Model.RePersonelIdSecond';

                $("#RePersonelIdFist").val(firstUserId);
                $("#RePersonelIdSecond").val(secondUserId);
            });
        }
    </script>

</head>
<body>

    <form id="formmain">

        <div class="bd" style="border-bottom: none; margin: 1px;">
            <table style="width: 100%; border: 0px;">
                <tr>
                    <td style="width: 50%;"></td>
                    <td style="width: 50%; text-align: right;">单据编号：
                        @Html.TextBoxFor(x => x.TempNo, new { @class = "casebottomtxt" })
                    </td>
                </tr>
            </table>

            <div class="ScrollBar" style="margin: 1px; overflow: hidden;">
                <div id="basic" class="tabPanel">
                    <fieldset style="margin-top: 10px;">
                        <legend>案件来源</legend>
                        <table class="form">
                            <tr>
                                <th class="formTitle">执法部门：<span style="color: Red;">*</span></th>
                                <td class="formValue" colspan="3">
                                    <select id="drpCompany" class="txtselect" style="height: 20px; width: 130px;" onchange="javascript:BindDepartment();"></select>
                                    <select id="drpDepartment" class="txtselect" style="height: 20px; width: 130px;" onchange="javascript:BindUser(this.value);"></select>
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">执法队员：<span style="color: Red;">*</span></th>
                                <td class="formValue" colspan="3">
                                    <select id="RePersonelIdFist" name="RePersonelIdFist" class="txtselect" style="height: 20px; width: 130px;"></select>
                                    <select id="RePersonelIdSecond" name="RePersonelIdSecond" class="txtselect" style="height: 20px; width: 130px;"></select>
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                    <fieldset style="margin-top: 10px;">
                        <legend>当前人情况</legend>
                        <table class="form">
                            <tr>
                                <th class="formTitle">当事人类型：<span style="color: Red;">*</span></th>
                                <td class="formValue">
                                    @Html.DropDownListFor(x => x.TargetType, (ViewData["TargetTypes"] as IEnumerable<SelectListItem>), new { @class = "txtselect", @style = "height: 20px; width: 130px", @onchange = "javascript:ChangeTargetType(this.value)" })
                                </td>
                                <th class="formTitle">单位名称：<span style="color: Red;" id="spanCompany">*</span></th>
                                <td class="formValue">
                                    @Html.TextBoxFor(x => x.TargetUnit, new { @style = "width: 100%;", @class = "txt" })
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">
                                    <label id="labTargetName">当事人姓名</label>：<span style="color: Red;" id="spanUserName">*</span></th>
                                <td class="formValue">
                                    @Html.TextBoxFor(x => x.TargetName, new { @style = "width: 100%;", @class = "txt" })
                                </td>
                                <th class="formTitle">职务：</th>
                                <td class="formValue">
                                    @Html.TextBoxFor(x => x.TargetDuty, new { @style = "width: 100%;", @class = "txt" })
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">证件类型：</th>
                                <td class="formValue">
                                    @Html.DropDownListFor(x => x.TargetPaperType, (ViewData["TargetPaperTypes"] as IEnumerable<SelectListItem>), new { @class = "txtselect", @style = "height: 20px; width: 130px" })
                                </td>
                                <th class="formTitle">证件号码：</th>
                                <td class="formValue">
                                    @Html.TextBoxFor(x => x.TargetPaperNum, new { @class = "txt", @style = "width: 100%;", @onblur = "javascript:PutCardId(this.value)" })
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">性别：</th>
                                <td class="formValue">
                                    @Html.DropDownListFor(x => x.TargetGender, (ViewData["Sexs"] as IEnumerable<SelectListItem>), new { @class = "txtselect", @style = "height: 20px; width: 130px" })
                                </td>
                                <th class="formTitle">年龄：</th>
                                <td class="formValue">
                                    @Html.TextBoxFor(x => x.TargetAge, new { @class = "txt", @style = "width: 100%;", @Value = Model.TargetAge == 0 ? "" : Model.TargetAge.ToString() })
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">联系电话：</th>
                                <td class="formValue">
                                    @Html.TextBoxFor(x => x.TargetPhone, new { @class = "txt", @style = "width: 100%;" })
                                </td>
                                <th class="formTitle">联系手机：</th>
                                <td class="formValue">
                                    @Html.TextBoxFor(x => x.TargetMobile, new { @class = "txt", @style = "width: 100%;" })
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">邮编：</th>
                                <td class="formValue">
                                    @Html.TextBoxFor(x => x.TargetZipCode, new { @class = "txt", @style = "width: 100%;" })
                                </td>
                                <th class="formTitle">电子邮件：</th>
                                <td class="formValue">
                                    @Html.TextBoxFor(x => x.TargetEmail, new { @class = "txt", @style = "width: 100%;" })
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">地址：</th>
                                <td class="formValue" colspan="3">
                                    @Html.TextBoxFor(x => x.TargetAddress, new { @class = "txt", @style = "width: 100%;" })
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">拒绝表达身份：<span style="color: Red;">*</span></th>
                                <td class="formValue" colspan="3">
                                    @*@Html.CheckBox("ChkIsRefused", new { @checked = @Model.IsRefused })<label for="ChkIsRefused">当事人拒绝表达身份</label>*@

                                    <input type="checkbox" id="ChkIsRefused" name="ChkIsRefused" @(Model.IsRefused == 1 ? "checked=\"checked\"" : "")/>
                                    <label for="ChkIsRefused">当事人拒绝表达身份</label>

                                </td>
                            </tr>
                        </table>
                    </fieldset>
                    <fieldset>
                        <legend>案件基本情况</legend>
                        <table class="casedt">
                            <tr>
                                <th class="formTitle">案由编号：<span style="color: Red;">*</span></th>
                                <td class="formValue" style="width: 130px;">
                                    @Html.TextBox("ItemNo", "", new { @style = "width:100%", @class = "txt", @onblur = "GetItems(this.value)" })
                                </td>
                                <th class="formTitle">案件类别：</th>
                                <td class="formValue">
                                    @Html.DropDownList("ClassNo", (ViewData["ClassNos"] as IEnumerable<SelectListItem>), new { @class = "txtselect", @style = "height: 20px; width: 130px", @onchange = "javascript:ChangeClassNo(this.value,'ItemActs')" })

                                    <select id="ItemActs" class="txtselect" style="height: 20px; width: 40%" onchange="javascript:ChangetItemAct(this.value,'ItemNames');"></select>
                                    <select id="ItemNames" class="txtselect" style="height: 20px; width: 25%" onchange="javascript:ChangeItemName(this.value,'GistNames','DutyNames');"></select>

                                    @Html.Hidden("LegislationId")
                                    @Html.Hidden("LegislationItemId")
                                    @Html.Hidden("LegislationGistId")
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">管理依据：</th>
                                <td class="formValue" colspan="3">
                                    <select id="GistNames" class="txt" style="width: 100%" onchange="javascript:ChangeGist('GistNames');"></select>
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">法律责任：</th>
                                <td class="formValue" colspan="3">
                                    <select id="DutyNames" class="txt" style="width: 100%" onchange="javascript:ChangeGist('DutyNames');"></select>
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">单据类型：<span style="color: Red;">*</span></th>
                                <td class="formValue">
                                    @Html.DropDownListFor(x => x.TempType, (ViewData["TempTypes"] as IEnumerable<SelectListItem>), new { @class = "txtselect ", @style = "height: 20px; width: 130px" })
                                </td>

                                <th class="formTitle">案件状态：</th>
                                <td class="formValue">@EnumOperate.GetEnumDesc((TempDetainSate)Model.State)  </td>
                            </tr>
                            <tr>
                                <th class="formTitle">查处日期：<span style="color: Red;">*</span></th>
                                <td class="formValue" colspan="3">
                                    @Html.TextBoxFor(x => x.TempDateTime, new { @class = "txt Wdate", Value = Model.TempDateTime.ToString("yyyy-MM-dd HH:mm"), @onfocus = "WdatePicker({dateFmt:'yyyy-MM-dd'})", @style = "width:150px" })</td>
                            </tr>
                            <tr>
                                <th class="formTitle">查处地点：<span style="color: Red;">*</span></th>
                                <td class="formValue" colspan="3">
                                    @Html.TextBoxFor(x => x.TempAddress, new { @style = "width:100%", @class = "txt" })
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">通知书编号：</th>
                                <td class="formValue" colspan="3">
                                    @Html.TextBoxFor(x => x.NoticeNo, new { @style = "width:100%", @class = "txt" })
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">证据材料：</th>
                                <td class="formValue" colspan="3" id="EvidenceTD">
                                    @Html.Action("FilesTab", "TempDetain", new { resourceId = Model.Id, evtache = "tempdetain", isupload = "true" })
                                </td>
                            </tr>
                            <tr>
                                <th class="formTitle">仓库编号：</th>
                                <td class="formValue">
                                    @Model.WarehouseCode
                                </td>
                                <th class="formTitle">移交其它部门：</th>
                                <td class="formValue">
                                    @((withholdArticleList != null && withholdArticleList.Any()) ? withholdArticleList.FirstOrDefault().TransferDeptName : "")
                                </td>
                            </tr>
                        </table>
                    </fieldset>

                    <div style="width: 100%; text-align: right; margin-top: 10px;">
                        <input type="button" value="新增暂扣物品" class="btnSearch" onclick="javascript: addArticlesBox();" />
                    </div>

                    <fieldset style="">
                        <legend>物品情况</legend>
                        <table class="form" id="ArticlesBox">
                            <tr>
                                <th class="formTitle" style="text-align: center; height: 30px;">物品大类<span style="color: Red;">*</span>
                                </th>
                                <th class="formTitle" style="text-align: center;">物品小类
                                </th>
                                <th class="formTitle" style="text-align: center;">物品名称<span style="color: Red;">*</span>
                                </th>
                                <th class="formTitle" style="text-align: center;">规格型号
                                </th>
                                <th class="formTitle" style="text-align: center;">物品数量<span style="color: Red;">*</span>
                                </th>
                                <th class="formTitle" style="text-align: center;">物品单位<span style="color: Red;">*</span>
                                </th>
                                <th class="formTitle" style="text-align: center;">状  态
                                </th>
                                <th class="formTitle" style="text-align: center; width: 100px;">操  作
                                </th>
                            </tr>
                            @if (withholdArticleList != null && withholdArticleList.Any())
                            {
                                int indexStr = 0;
                                foreach (TempDetainGoodsEntity item in withholdArticleList)
                                {
                                <tr>
                                    <th class="formValue">
                                        <select name="ArticleTypeI" id="@("ArticleTypeI_" + indexStr)" class="select" style="height: 25px; width: 100%;">
                                            @if (articleTypeList != null)
                                            {
                                                var articleTypeIList = articleTypeList.Where(x => x.ParentId == "0039").ToList();
                                                foreach (var typeEntity in articleTypeIList)
                                                {
                                                <option value="@typeEntity.Id" @(typeEntity.Id == item.ClassI ? "selected=\"selected\"" : "")>@typeEntity.RsKey</option>
                                                }
                                            }
                                        </select>
                                    </th>
                                    <th class="formValue">
                                        <select name="ArticleTypeII" class="select" style="height: 25px; width: 100%;">
                                            @if (articleTypeList != null)
                                            {
                                                var articleTypeIiList = articleTypeList.Where(x => x.ParentId == item.ClassI).ToList();
                                                foreach (var typeEntity in articleTypeIiList)
                                                {
                                                <option value="@typeEntity.Id" @(typeEntity.Id == item.ClassII ? "selected=\"selected\"" : "")>@typeEntity.RsKey</option>
                                                }
                                            }
                                        </select>
                                    </th>
                                    <th class="formValue">
                                        <input class="txt required" datacol="yes"  err = "物品名称" checkexpession = "NotNull" name="ArticleName" type="text" value="@item.GoodsName" style="text-align:center"></th>
                                    <th class="formValue">
                                        <input class="txt" name="SpecificationType" type="text" value="@item.Specification" style="text-align: center;"></th>
                                    <th class="formValue">
                                        <input class="txt required" datacol = "yes" err = "物品数量" checkexpession = "Num" name="ArticleCount" type="text" value="@item.GoodsCount" style="text-align: center;"></th>
                                    <th class="formValue">
                                        <select name="ArticleUnit" class="select" style="height: 25px; width: 100%;">
                                            @if (articleUnitIlist != null)
                                            {
                                                foreach (var unitEntity in articleUnitIlist)
                                                {
                                                <option value="@unitEntity.Id" @(unitEntity.Id == item.GoodsUnit ? "selected=\"selected\"" : "")>@unitEntity.RsKey</option>
                                                }
                                            }
                                        </select>

                                    </th>
                                    <th class="formValue" style="text-align: center;">@(Yookey.WisdomClassed.SIP.Enumerate.EnumOperate.GetEnumDesc((Yookey.WisdomClassed.SIP.Enumerate.TempDetainSate)item.State))</th>
                                    <th class="formValue" style="text-align: center;">
                                        @if (indexStr != 0)
                                        {
                                            <input type="button" class="btnSearch" style="background: url('@Url.Content("~/Content/Images/Icon16/DeleteRed.png")')50% 4px no-repeat; border:0;" onclick="deleteLeg(this);"/>
                                        }
                                        @if (Model.State == 1 && item.State == 1 && decayPriceless)
                                        {
                                            <input type="button" class="btnSearch" value="腐烂无价" id="@item.Id" onclick="PricelessProcessing(this.id)" style="text-align: center;"/>
                                        }
                                    </th>
                                </tr>
                                        indexStr++;
                                }
                            }
                            <tr id="ContentTR" style="display: none;">
                                <th class="formValue">
                                    @Html.DropDownList("ArticleTypeI", (ViewData["ArticleTypeI"] as IEnumerable<SelectListItem>), new { @class = "select", @style = "height: 25px;width: 100%;", @onchange = "javascript:ChangeArticleTypeI(this.options[this.options.selectedIndex].value,this.id);" })
                                </th>
                                <th class="formValue">
                                    <select name="ArticleTypeII" id="ArticleTypeII" class="select" style="height: 25px; width: 100%;"></select>
                                </th>
                                <th class="formValue">
                                    <input checkexpession name="ArticleName" type="text" value="" style="text-align: center;"></th>
                                <th class="formValue">
                                    <input class="txt" name="SpecificationType" type="text" value="" style="text-align: center;"></th>
                                <th class="formValue">
                                    <input checkexpession2 name="ArticleCount" type="text" value="" style="text-align: center;"></th>
                                <th class="formValue" style="text-align: center">
                                    @Html.DropDownList("ArticleUnit", (ViewData["ArticleUnit"] as IEnumerable<SelectListItem>), new { @class = "select", @style = "height: 25px;width: 100%;", @onchange = "javascript:ChangeArticleTypeI(this.options[this.options.selectedIndex].value,this.id);" })
                                </th>
                                <th class="formValue" style="text-align: center;">待入库</th>
                                <th class="formValue">
                                    <input type="button" class="btnSearch" style="background: url('@Url.Content("~/Content/Images/Icon16/DeleteRed.png")')50% 4px no-repeat; border:0;" onclick="deleteLeg(this);"  style="text-align: center;"/>
                                </th>
                            </tr>
                        </table>

                        @* @Html.HiddenFor(x => x.Id)*@
                        <input  type="hidden" name="Id" value="@Model.Id"/>
                        @Html.HiddenFor(x => x.CaseId)
                        @Html.HiddenFor(x => x.IsRefused)
                        @Html.HiddenFor(t => t.CreatorId)
                        @Html.HiddenFor(t => t.CreateBy)
                        @Html.HiddenFor(t => t.CreateOn)
                        @Html.HiddenFor(x => x.CompanyId)
                        @Html.HiddenFor(x => x.DepartmentId)
                        @Html.HiddenFor(t => t.CompanyName)
                        @Html.HiddenFor(t => t.DepartmentName)
                        @Html.HiddenFor(x => x.RePersonelNameFist)
                        @Html.HiddenFor(x => x.RePersonelNameSecond)
                        @Html.HiddenFor(x => x.RoadNo)
                        @Html.HiddenFor(x => x.RoadName)
                        @Html.HiddenFor(x => x.State)
                        @Html.HiddenFor(x => x.RowStatus)

                    </fieldset>

                    @if (tempDetainInfoProcessList != null && tempDetainInfoProcessList.Any())
                    {
                        <fieldset style="">
                            <legend>处理审批日志</legend>
                            <table class="form" id="ArticlesBox">
                                <tr>
                                    <th class="formTitle" style="width: 8px;"></th>
                                    <th class="formTitle" style="text-align: center;">处理人
                                    </th>
                                    <th class="formTitle" style="text-align: center;">操作
                                    </th>
                                    <th class="formTitle" style="text-align: center;">处理意见
                                    </th>
                                    <th class="formTitle" style="text-align: center;">时间
                                    </th>
                                </tr>

                                @{   int indexStr = 1;
                                     foreach (TempDetainInfoProcessEntity item in tempDetainInfoProcessList.OrderByDescending(r => r.CreateOn))
                                     {
                                    <tr>
                                        <th class="formValue" style="text-align: center; font-weight: initial;">@indexStr</th>
                                        <th class="formValue" style="text-align: center; font-weight: initial;">@item.UserName</th>
                                        <th class="formValue" style="text-align: center; font-weight: initial;">@item.Before  -->  @item.After</th>
                                        <th class="formValue" style="text-align: center; font-weight: initial;">@item.Idea</th>
                                        <th class="formValue" style="text-align: center; font-weight: initial;">@item.CreateOn</th>
                                    </tr>

                                         indexStr++;
                                     }
                                }
                            </table>
                        </fieldset>
                    }



                    <table class="form">
                        <tr>
                            <td style="padding-top: 10px; padding-bottom: 10px; text-align: center;" colspan="4">
                                @if (Model.State == (int)TempDetainSate.ToInStorage && inStorage)
                                {
                                    <input type="button" class="btnSearch" value="确认入库" onclick="HandleIdea(this, 1);" />
                                    <span>&nbsp; &nbsp; &nbsp; &nbsp;</span>
                                }

                                @if (Model.State == (int)TempDetainSate.InStorage && hasReturned)
                                {
                                    <input type="button" class="btnSearch" value="教育处理" onclick="HandleIdea(this, 2);" />
                                    <span>&nbsp; &nbsp; &nbsp; &nbsp;</span>
                                }

                                @if (Model.State == (int)TempDetainSate.InStorage && transferDept)
                                {
                                    <input type="button" class="btnSearch" value="移交其它部门" onclick="HandleIdea(this, 3);" />
                                    <span>&nbsp; &nbsp; &nbsp; &nbsp;</span>
                                }
                                @if (Model.State == (int)TempDetainSate.InStorage)
                                {
                                    <input type="button" class="btnSearch" value="转入处罚" onclick="ToPenaltyCase();" />
                                    <span>&nbsp; &nbsp; &nbsp; &nbsp;</span>
                                }


                                @if (Model.State == (int)TempDetainSate.HasReturned || Model.State == (int)TempDetainSate.Punish)
                                {
                                    <input type="button" class="btnSearch" value="发还" onclick="HandleIdea(this, 6);" />
                                    <span>&nbsp; &nbsp; &nbsp; &nbsp;</span>
                                }
                                @if (Model.State == (int)TempDetainSate.HasReturned || Model.State == (int)TempDetainSate.Punish || Model.State == (int)TempDetainSate.ReturnTo)
                                {
                                    <input type="button" class="btnSearch" value="打印发还单" onclick="doPrint('Inventory')" />
                                    <span>&nbsp; &nbsp; &nbsp; &nbsp;</span>
                                }

                            </td>
                        </tr>
                    </table>

                </div>
            </div>
        </div>
    </form>
</body>
</html>

<script type="text/javascript">

    //更改当事人类型
    function ChangeTargetType(targetType) {
        if (targetType == "00120002") {     //法人
            $("#labTargetName").text("负责人姓名");
            $("#spanCompany").show();
            $("#spanUserName").hide();
        } else {
            $("#labTargetName").text("当事人姓名");
            $("#spanCompany").hide();
            $("#spanUserName").show();
        }
    }

    //输入证件号码后计算
    function PutCardId(cardId) {
        if ($("#TargetPaperType").val() == "00130001") {
            if (parseInt(cardId.substr(16, 1)) % 2 == 1) {
                $("#TargetGender").val("1");  //男
            } else {
                $("#TargetGender").val("0");  //女
            }
            //获取年龄 
            var myDate = new Date();
            var month = myDate.getMonth() + 1;
            var day = myDate.getDate();

            var age = myDate.getFullYear() - cardId.substring(6, 10) - 1;
            if (cardId.substring(10, 12) < month || cardId.substring(10, 12) == month && cardId.substring(12, 14) <= day) {
                age++;
            }
            $("#TargetAge").val(age);
        }
    }

    //更改大类
    function ChangeClassNo(classNo, selectId, legislationId, legislationItemId, legislationGistId) {
        getAjax("@Url.Action("AjLoadItemActs", "PenaltyCaseAjax")", { classNo: classNo, selectId: selectId }, function (msg) {
            eval(msg);
            if (legislationId != '' && legislationId != undefined) {
                $("#" + selectId).val(legislationId);
                $("#LegislationId").val(legislationId);
                ChangetItemAct(legislationId, "ItemNames", legislationItemId, legislationGistId);
            }
        });
    }

    /*
     * 更改违法行为
     * legislationId:违法行为ID
     * selectId:控件ID
     * defaultVal:默认值
     */
    function ChangetItemAct(legislationId, selectId, legislationItemId, legislationGistId) {
        SelectItem(legislationId);
        $("#LegislationId").val(legislationId);
        getAjax("@Url.Action("AjLoadItemNames", "PenaltyCaseAjax")", { legislationId: legislationId, selectId: selectId }, function (msg) {
            eval(msg);
            if (legislationItemId != '' && legislationItemId != undefined) {
                $("#" + selectId).val(legislationItemId);

                $("#LegislationId").val(legislationId);
                $("#LegislationItemId").val(legislationItemId);
            }
            ChangeItemName($("#" + selectId).val(), "GistNames", "DutyNames", legislationGistId);
        });
    }

    /*
     * 更改适用案由
     * legislationItemId:案由ID
     * selectId:控件ID
     * defaultVal:默认值
     */
    function ChangeItemName(legislationItemId, selectId, selectId2, legislationGistId) {
        getAjax("@Url.Action("AjaxLoadGist", "PenaltyCaseAjax")", { legislationItemId: legislationItemId, selectId: selectId, selectId2: selectId2 }, function (msg) {
            eval(msg);
            $("#LegislationItemId").val(legislationItemId);
            if (legislationGistId != '' && legislationGistId != undefined) {
                $("#" + selectId).val(legislationGistId);
                $("#" + selectId2).val(legislationGistId);
                $("#LegislationGistId").val(legislationGistId);
            } else {
                $("#LegislationGistId").val($("#" + selectId).val());
            }
        });
    }

    /*
     *  更改法律条文 
     */
    function ChangeGist(selectId) {
        var sel = $("#" + selectId).val();
        $("#GistNames").val(sel);
        $("#DutyNames").val(sel);
        $("#LegislationGistId").val(sel);
    }

    //选择小类
    function SelectItem(itemId) {
        AjaxJson("@Url.Action("LoadItemDetails", "PenaltyCaseAjax")", { itemId: itemId }, function (msg) {
            $("#ItemNo").val(msg.rtObj.ItemNo);
        });
    }

    //根据案由编号快速查询
    function GetItems(itemNo) {
        AjaxJson("@Url.Action("LoadItemDetails", "PenaltyCaseAjax")", { itemNo: itemNo }, function (msg) {
            $("#ClassNo").val(msg.rtObj.ClassNo);
            ChangeClassNo(msg.rtObj.ClassNo, 'ItemActs', msg.rtObj.Id);
        });
    }

    var tempIndex = $("#ArticlesBox tr").length;
    //添加物品
    function addArticlesBox() {
        tempIndex++;
        var num = tempIndex;
        var html = $('#ContentTR').html();
        html = html.replace('id=\"ArticleTypeI\"', 'id=\"ArticleTypeI_' + num + '\"');
        html = html.replace('checkexpession', "class=\"txt required\" datacol = \"yes\" err = \"物品名称\" checkexpession = \"NotNull\"");
        html = html.replace('checkexpession2', "class=\"txt required\" datacol = \"yes\" err = \"物品数量\" checkexpession = \"Num\"");
        html = "<tr>" + html + "</tr>";
        $(html).insertBefore($("#ArticlesBox>tbody>tr:last"));
    };

    //删除物品
    function deleteLeg(obj) {
        $(obj).parent().parent().remove();
    };

    //更改物品大类
    function ChangeArticleTypeI(typeId, id, defaultValue) {
        getAjax("@Url.Action("AjaxLoadArticleTypeIi", "TempDetain")", { typeId: typeId, defaultSelId: defaultValue }, function (msg) {
            $("#" + id).parent().next("th").find("#ArticleTypeII").html(msg);
        });
    }

    //保存案件
    function AcceptClick() {
        if (CheckValidator()) {

            $("#CompanyId").val($("#drpCompany").val());
            $("#DepartmentId").val($("#drpDepartment").val());
            $("#CompanyName").val($("#drpCompany").find("option:selected").text());
            $("#DepartmentName").val($("#drpDepartment").find("option:selected").text());
            $("#RePersonelNameFist").val($("#RePersonelIdFist").find("option:selected").text());
            $("#RePersonelNameSecond").val($("#RePersonelIdSecond").find("option:selected").text());

            Loading(true, "正在提交数据...");
            AjaxJson('@Url.Action("SaveTempDetain", "TempDetain")', $('#formmain').serialize(), function (data) {
                alertDialog("保存成功！", 1);
            });
        }
    }


    //验证表单信息
    function CheckValidator() {
        var istrue = true;
        if ($("#drpCompany").val() == '') {
            alertDialog('请选择执法部门！', -1);
            $("#drpCompany").focus();
            istrue = false;
        }
        if ($("#drpDepartment").val() == '') {
            alertDialog('请选择执法中队！', -1);
            $("#drpDepartment").focus();
            istrue = false;
        }

        if ($("#RePersonelIdFist").val() == '') {
            alertDialog('请选择执法队员！', -1);
            $("#RePersonelIdFist").focus();
            istrue = false;
        }

        if ($("#RePersonelIdSecond").val() == '') {
            alertDialog('请选择执法队员！', -1);
            $("#RePersonelIdSecond").focus();
            istrue = false;
        }

        //当事人未拒绝表达身份，验证当事人信息
        if ($("#ChkIsRefused").attr('checked') == false || $("#ChkIsRefused").attr('checked') == undefined) {
            if ($("#TargetType").val() == '') {
                alertDialog('请选择当事人类型！', -1);
                $("#TargetType").focus();
                istrue = false;
                $("#IsRefused").val(0);
            }

        } else {
            $("#IsRefused").val(1);
        }

        if ($("#ItemNo").val() == '') {
            alertDialog('请输入案由编号！', -1);
            $("#ItemNo").focus();
            istrue = false;
        }

        if ($("#TempType").val() == '') {
            alertDialog('请选择单据类型！', -1);
            $("#TempType").val().focus();
            istrue = false;
        }


        if ($("#TempDateTime").val() == '') {
            alertDialog('查处日期不能为空！', -1);
            $("#TempDateTime").val().focus();
            istrue = false;
        }
        if ($("#TempAddress").val() == '') {
            alertDialog('查处地点不能为空！', -1);
            $("#TempAddress").val().focus();
            istrue = false;
        }
        return istrue;
    }

</script>

<script type="text/javascript">
    //审核
    function HandleIdea(v, state) {
        var url = '@Url.Action("HandleIdea", "TempDetain")?id=@Model.Id ' + '&state=' + state;
        top.$.dialog({
            id: "HandleIdea", width: 500, height: 280, lock: true, max: false, resize: false, extendDrag: true,
            title: $(v).val() + "意见",
            content: 'url:' + url,
            button: [
                {
                    name: '保存',
                    className: 'green',
                    callback: function () {
                        top.frames["HandleIdea"].AcceptClick('TempDetainEdit');
                        return false;
                    }
                },
                {
                    name: '关 闭'
                }
            ]
        });
    };

    //物品腐烂
    function PricelessProcessing(id) {
        if (IsDelData(id)) {
            var url = '@Url.Action("HandlePricelessProcessing", "TempDetain")';
            var parm = 'id=' + id;
            confirmDialog("系统提示", "您确定物品已腐烂无价?", function (r) {
                if (r) {
                    Loading(true, "正在处理数据...");
                    window.setTimeout(function () {
                        AjaxJson(url, parm, function (data) {
                            tipDialog(data.rtMsrg, 3, data.rtState);
                            if (data.rtState > 0) {
                                windowload();
                            }
                        });
                    }, 200);
                }
            });
        }
    };

    function ApplyReturn() {
        top.frames[tabiframeId()].windowload();
        closeDialog();
    };

    //刷新
    function windowload() {
        window.location.reload();//刷新当前页面.

    }
</script>

<script type="text/javascript">
    // 转入处罚
    function ToPenaltyCase() {

        var url = '@Url.Action("ToPenaltyCase", "TempDetain")';
        var parm = 'id=' + '@Model.Id';
        confirmDialog("系统提示", "您确定要转入处罚流程吗?", function (r) {
            if (r) {
                Loading(true, "正在处理数据...");
                window.setTimeout(function () {
                    AjaxJson(url, parm, function (data) {
                        tipDialog(data.rtMsrg, 3, data.rtState);
                        if (data.rtState > 0) {

                            var caseEntity = '@Url.Action("Main", "PenaltyCase")';
                            var width = $(window).width() + 50;
                            var height = $(window).height();
                            Dialog((caseEntity + "?id=" + data.caseinfoId + '&rnd=' + Math.random()), "FirstDialogWindow", "案件详情", width, height);

                            closeDialog();
                        }
                    });
                }, 200);
            }
        });
    }

    //打印文书
    function doPrint(writIdentify) {
        var id = '@Model.Id';
        getAjax('@Url.Action("GetCaseWrit", "PenaltyCaseWrit")', { writIdentify: writIdentify, resourceId: id }, function (url) {
            var mydoc;
            var myDocApp = new ActiveXObject("word.Application");
            myDocApp.visible = true;
            myDocApp.activate();
            mydoc = myDocApp.documents.add(url);
            try {
                mydoc.PrintPreview();
            } catch (e) {
                alert("打印预览失败，请确认您的电脑上装有office！");
            }
        });
    }
</script>
