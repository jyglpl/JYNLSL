@using Yookey.WisdomClassed.SIP.Membership
@{
    Layout = null;
    @model Yookey.WisdomClassed.SIP.Model.IllegalConstruction.IllegalConstructionEntity
}

@{
    var btnSave = this.Html.IsAllowed("IllegalConstruction", "btnSave");
    var btnSettlement = this.Html.IsAllowed("IllegalConstruction", "btnSettlement");
}

@using System.Data
@using Yookey.WisdomClassed.SIP.Common;

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>店招标牌基本信息</title>

    <!--框架必需start-->
    <link href="@Url.Content("~/Content/Styles/learunui-accordion.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/Styles/learunui-framework.css")" rel="stylesheet" />
    <script src="@Url.Content("~/Librarys/jquery/jquery-1.8.2.min.js")"></script>
    <script src="@Url.Content("~/Librarys/learunui-framework.js")"></script>
    <!--框架必需end-->
    <!--布局组件start-->
    <script src="@Url.Content("~/Librarys/layout/splitter.js")"></script>
    <!--布局组件end-->

    <!--日期组件start-->
    <script src="@Url.Content("~/Librarys/datepicker/WdatePicker.js")"></script>
    <!--日期组件end-->
    <script src="@Url.Content("~/Librarys/validator/learunui-validator.js")"></script>
    <script src="@Url.Content("~/Librarys/jquery_form_min.js")"></script>

    <!--引入弹窗组件start-->
    <script src="@Url.Content("~/Librarys/lhgdialog/lhgdialog.min.js")" type="text/javascript"></script>
    <!--引入弹窗组件end-->



    <!--评分星级插件-->
    <script src="@Url.Content("~/Librarys/Raty/jquery.raty.js")"></script>
    <!--评分星级插件结束-->

    @*    <!--固定元素-->
    <script src="@Url.Content("~/Librarys/stickUp/stickUp.min.js")"></script>
    <!--固定元素end-->*@


    <!--图片预览-->
    @* <link href="@Url.Content("~/Librarys/viewerjs/viewer.css")" rel="stylesheet" />
    <script src="@Url.Content("~/Librarys/viewerjs/viewer.js")"></script>*@


    <!--图片预览end-->

    <style type="text/css">
        .radioLeft {
            margin-left: 10px;
        }

        .formTitle {
            width: 145px;
        }
    </style>
</head>
<body>

    <div>
        @using (Html.BeginForm("AcceptClick", "IllegalConstruction", FormMethod.Post, new { @id = "formmain", @enctype = "multipart/form-data" }))
        {
            <div style="margin-left: 5px; margin-right: 5px;">
                <table style="width: 1050px; border: 0px;" id="head">
                    <tr>
                        <td style="width: 50%; text-align: left;"></td>
                        <td style="width: 50%; text-align: right;">案件编号：
                                @Html.TextBoxFor(x => x.CaseInfoNo, "", new { @class = "casebottomtxt", @style = "width: 300px" })
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 50%; text-align: left;"></td>
                        <td style="width: 50%; text-align: right;">
                            <input type="button" value="审批流程" class="casebtn" onclick=" javascript: ShowCaseFlow(); " />
                        </td>
                    </tr>
                </table>

                <table id="sqTable" class="casedt" style="width: 1050px; border-right: 1px solid #ccc;">
                    <tr>
                        <td id="bengin1" rowspan="@(Model.State > 3 || !string.IsNullOrEmpty(Model.DismantleCompanyId) ? "15" : "14")" class="formValue" style="width: 85px; text-align: center;">拆<br />
                            除<br />
                            申<br />
                            请<br />
                            表<br />
                        </td>
                        <th class="formTitle">拆除类型：</th>
                        <td class="formValue">
                            @Html.DropDownListFor(x => x.DismantlingType, (ViewData["DismantlingTypes"] as IEnumerable<SelectListItem>), new { @class = "txtselectN", @style = "width: 303px", @onchange = "ChangeDismantlingType();" })
                            <span style="color: Red;">*</span>
                        </td>
                        <th class="formTitle" style="background: none;"></th>
                        <td class="formValue"></td>
                    </tr>

                    <tr>
                        <th class="formTitle">申请类别：</th>
                        <td class="formValue">
                            @Html.DropDownListFor(x => x.ApplicationType, (ViewData["ApplicationTypes"] as IEnumerable<SelectListItem>), new { @class = "txtselectN", @style = "width: 303px" })
                            <span style="color: Red;">*</span>
                        </td>
                        <th class="formTitle">停违/整改通知书：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.NoticeNo, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "NotNull", @err = "停违/整改通知书", @datacol = "yes" })
                            <span style="color: Red;">*</span>
                        </td>
                    </tr>

                    <tr>
                        <th class="formTitle">执法部门：</th>
                        <td class="formValue">
                            <select id="drpCompany" class="txtselectN" style="width: 303px;" onchange="javascript:BindDepartment();"></select>
                            <span style="color: Red;">*</span>
                        </td>
                        <th class="formTitle">执法中队：</th>
                        <td class="formValue">
                            <select id="drpDepartment" class="txtselectN" style="width: 303px;" onchange="javascript:BindUser(this.value);"></select>
                            <span style="color: Red;">*</span>
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle">申请人：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.ApplicationUserName, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "NotNull", @err = "申请人", @datacol = "yes" })
                            <span style="color: Red;">*</span>
                        </td>
                        <th class="formTitle">联系电话：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.ApplicationMobile, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "NotNull", @err = "联系电话", @datacol = "yes" })
                            <span style="color: Red;">*</span>
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle">来源：</th>
                        <td class="formValue">

                            <span class="item">
                                <input type="radio" name="DataSource" class="radioLeft" id="00730001" value="00730001" @(Model.DataSource.Equals("00730001") ? "checked=checked" : "")/>
                                <label id="lab_00730001" for="00730001">举报</label>
                            </span>
                            <span class="item">
                                <input type="radio" name="DataSource" class="radioLeft" id="00730002" value="00730002" @(Model.DataSource.Equals("00730002") ? "checked=checked" : "")/>
                                <label id="lab_00730002" for="00730002">自查</label>
                            </span>
                            <span class="item">
                                @Html.TextBoxFor(x => x.ReportDataSource, "", new { @style = "width: 192px;", @class = "txtborder", @checkexpession = "NotNull", @err = "违建来源", @datacol = "no" })
                            </span>
                            <span style="color: Red;">*</span>
                        </td>
                        <th class="formTitle">来源编号：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.DataSourceNum, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "NotNull", @err = "申请人", @datacol = "no" })
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle">体量：<span style="color: Red;">*</span></th>
                        <td class="formValue">
                            <table class="lawbox">
                                <tr>
                                    <td>长：</td>
                                    <td>
                                        @Html.TextBoxFor(x => x.Length, "", new { @style = "width: 80px;", @class = "txtborder", @checkexpession = "NotNull", @err = "体量-长", @datacol = "yes" })
                                    </td>
                                    <td>宽：</td>
                                    <td>
                                        @Html.TextBoxFor(x => x.Widht, "", new { @style = "width: 80px;", @class = "txtborder", @checkexpession = "NotNull", @err = "体量-宽", @datacol = "yes" })
                                    </td>
                                    <td>高：</td>
                                    <td>
                                        @Html.TextBoxFor(x => x.Height, "", new { @style = "width: 80px;", @class = "txtborder", @checkexpession = "NotNull", @err = "体量-高", @datacol = "yes" })
                                    </td>
                                </tr>
                            </table>
                        </td>
                        <th class="formTitle">状态：</th>
                        <td class="formValue">
                            @Html.DropDownListFor(x => x.UnbuiltState, (ViewData["UnbuiltStates"] as IEnumerable<SelectListItem>), new { @class = "txtselectN", @style = "width: 303px" })
                            <span style="color: Red;">*</span>
                        </td>
                        <tr>
                            <th class="formTitle">当事人：</th>
                            <td class="formValue">
                                @Html.TextBoxFor(x => x.TargetName, "", new { @style = "width: 300px;", @class = "txtborder" })
                            </td>
                            <th class="formTitle">类别：</th>
                            <td class="formValue">
                                @Html.DropDownListFor(x => x.TargetType, (ViewData["TargetTypes"] as IEnumerable<SelectListItem>), new { @class = "txtselectN", @style = "width: 303px" })
                            </td>
                        </tr>
                    <tr>
                        <th class="formTitle">联系电话：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.TargetMobile, "", new { @style = "width: 300px;", @class = "txtborder" })
                        </td>
                        <th class="formTitle">地点：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.TargetAddress, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "NotNull", @err = "地点", @datacol = "yes" })
                            <span style="color: Red;">*</span>
                        </td>
                    </tr>

                    <tr id="trI_HouseAttr">
                        <th class="formTitle">违建日期：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.UnbuiltDate, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "NotNull", @err = "违建日期", @datacol = "no" })
                            <span style="color: Red;">*</span>
                        </td>
                        <th class="formTitle">房屋结构：</th>
                        <td class="formValue">
                            @Html.DropDownListFor(x => x.HousStructure, (ViewData["HousStructures"] as IEnumerable<SelectListItem>), new { @class = "txtselectN", @style = "width: 303px" })
                            <span style="color: Red;">*</span>
                        </td>
                    </tr>
                    <tr id="trII_HouseAttr">
                        <th class="formTitle">占地面积（㎡）：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.FloorSpace, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "Num", @err = "占地面积", @datacol = "no" })
                            <span style="color: Red;">*</span>
                        </td>
                        <th class="formTitle">建筑面积（㎡）：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.AreaOfStructure, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "Num", @err = "建筑面积", @datacol = "no" })
                            <span style="color: Red;">*</span>
                        </td>
                    </tr>


                    <tr id="trI_AdverAttr">
                        <th class="formTitle">设置日期：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.UnbuiltDate, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "NotNull", @err = "设置日期", @datacol = "no" })
                            <span style="color: Red;">*</span>
                        </td>
                        <th class="formTitle">广告类型：</th>
                        <td class="formValue">
                            @Html.DropDownListFor(x => x.AdvertisementType, (ViewData["AdvertisementTypes"] as IEnumerable<SelectListItem>), new { @class = "txtselectN", @style = "width: 303px" })
                            <span style="color: Red;">*</span>
                        </td>
                    </tr>

                    <tr id="trII_AdverAttr">
                        <th class="formTitle">面积：</th>
                        <td class="formValue" colspan="3">
                            @Html.TextBoxFor(x => x.AreaOfStructure, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "Num", @err = "广告面积", @datacol = "no" })
                            <span style="color: Red;">*</span>
                        </td>
                    </tr>

                    <tr class="alreadyHide">
                        <th class="formTitle">集合时间：</th>
                        <td class="formValue">
                            @Html.TextBox("LetterOfPresentationSetTime", Model.LetterOfPresentationSetTime.Year > 1900 ? Model.LetterOfPresentationSetTime.ToString(AppConst.DateFormatLong) : "", new { @style = "width: 300px;", @class = "txtborder", @onfocus = "WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" })
                            <span style="color: Red;">*</span>
                        </td>
                        <th class="formTitle">集合地点：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.LetterOfPresentationCollectionPlace, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "NotNull", @err = "集合地点", @datacol = "no" })
                        </td>
                    </tr>

                    <tr>
                        <th class="formTitle">备注：</th>
                        <td class="formValue" colspan="3">
                            @Html.TextArea("LetterOfPresentation", Model.LetterOfPresentation, new { @class = "txtborder", @style = "width: 781px;height:50px;", @checkexpession = "NotNull", @err = "情况说明", @datacol = "no" })
                        </td>
                    </tr>
                    <tr class="alreadyHide">
                        <th class="formTitle">拆除设备要求：</th>
                        <td class="formValue" colspan="3">
                            @Html.TextArea("EquipmentRequirements", Model.EquipmentRequirements, new { @class = "txtborder", @style = "width: 781px;height:50px;", @checkexpession = "NotNull", @err = "拆除设备要求", @datacol = "yes" })
                            <span style="color: Red;">*</span>
                        </td>
                    </tr>

                    @{
            if (Model.State > 3)
            {
                        <tr>
                            <th class="formTitle">结算分类：</th>
                            <td class="formValue" colspan="3">
                                <table class="lawbox">
                                    <tr>
                                        <td>@Html.RadioButtonFor(x => x.SettlementType, "00830001", new { @name = "SettlementType" })</td>
                                        <td>人工</td>
                                        <td>@Html.TextBoxFor(x => x.Manpower, "", new { @style = "width: 80px;", @class = "txtborder", @checkexpession = "NotNull", @err = "人力", @datacol = "no" })</td>
                                        <td>@Html.RadioButtonFor(x => x.SettlementType, "00830002", new { @name = "SettlementType" })</td>
                                        <td>防盗窗</td>
                                        <td>@Html.TextBoxFor(x => x.SecurityWindow, "", new { @style = "width: 80px;", @class = "txtborder", @checkexpession = "NotNull", @err = "防盗窗", @datacol = "no" })</td>
                                        <td>@Html.RadioButtonFor(x => x.SettlementType, "00830003", new { @name = "SettlementType" })</td>
                                        <td>系数</td>
                                        <td>@Html.TextBoxFor(x => x.Factor, "", new { @style = "width: 80px;", @class = "txtborder", @checkexpession = "NotNull", @err = "系数", @datacol = "no" })</td>
                                        <td>@Html.RadioButtonFor(x => x.SettlementType, "00830004", new { @name = "SettlementType" })</td>
                                        <td>整理性</td>
                                        <td>@Html.TextBoxFor(x => x.WholeReason, "", new { @style = "width: 80px;", @class = "txtborder", @checkexpession = "NotNull", @err = "整理性", @datacol = "no" })</td>
                                        <td>@Html.RadioButtonFor(x => x.SettlementType, "00830005", new { @name = "SettlementType" })</td>
                                        <td>封墙</td>
                                        <td>@Html.TextBoxFor(x => x.Wall, "", new { @style = "width: 80px;", @class = "txtborder", @checkexpession = "NotNull", @err = "封墙", @datacol = "no" })</td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
            }
                    }



                    @{
            if (Model.State > 3 || !string.IsNullOrEmpty(Model.DismantleCompanyId))
            {
                        <tr>
                            <th class="formTitle">拆除公司：</th>
                            <td class="formValue" colspan="3">
                                @ViewBag.DismantleCompany
                            </td>
                        </tr>
            }
                    }

                    <tr id="end1">
                        <td class="formTitle">证据材料</td>
                        <td class="formValue" colspan="3">
                            @Html.Action("IllegalFilesTab", "PenaltyCaseFile", new { controlId = "BeforeDismantling", resourceId = Model.Id, evtache = "BeforeDismantling", isupload = "true", isdeleted = "true" })
                        </td>
                    </tr>


                    @{
            if (Model.State >= 10)
            {

                        <tr>
                            <td rowspan="8" class="formValue" style="width: 85px; text-align: center;">拆<br />
                                除<br />
                                结<br />
                                果<br />
                            </td>
                            <td class="formTitle">拆中、拆后照片</td>
                            <td class="formValue" colspan="3">
                                @Html.Action("IllegalFilesTab", "PenaltyCaseFile", new { controlId = "Dismantling", resourceId = Model.Id, evtache = "Dismantling", isupload = "true", isdeleted = "true" })
                            </td>
                        </tr>
                        <tr>
                            <td class="formTitle">垃圾清运照片</td>
                            <td class="formValue" colspan="3">
                                @Html.Action("IllegalFilesTab", "PenaltyCaseFile", new { controlId = "GarbageClear", resourceId = Model.Id, evtache = "GarbageClear", isupload = "true", isdeleted = "true" })
                            </td>
                        </tr>
                        <tr>
                            <td class="formTitle">纸质确认清单</td>
                            <td class="formValue" colspan="3">
                                @Html.Action("IllegalFilesTab", "PenaltyCaseFile", new { controlId = "ListEvidence", resourceId = Model.Id, evtache = "ListEvidence", isupload = "true", isdeleted = "true" })
                            </td>
                        </tr>
                        <tr>
                            <th class="formTitle">拆除日期：</th>
                            <td class="formValue" colspan="3">
                                @Html.TextBox("DismantlingDate", Model.DismantlingDate.Year > 1900 ? Model.DismantlingDate.ToString(AppConst.DateFormatLong) : "", new { @style = "width: 300px;", @class = "txtborder", @onfocus = "WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})", @checkexpession = "NotNull", @err = "拆除日期", @datacol = "yes" })
                                <span style="color: Red;">*</span>
                            </td>
                        </tr>
                        <tr>
                            <th class="formTitle">实际拆除面积（㎡）：</th>
                            <td class="formValue">
                                @Html.TextBoxFor(x => x.DismantleArea, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "NotNull", @err = "实际拆除面积", @datacol = "yes" })
                                <span style="color: Red;">*</span>
                            </td>
                            <th class="formTitle">清运垃圾（吨）：</th>
                            <td class="formValue">
                                @Html.TextBoxFor(x => x.GarbageTon, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "NotNull", @err = "实际清运垃圾", @datacol = "yes" })
                                <span style="color: Red;">*</span>
                            </td>
                        </tr>
                        <tr>
                            <th class="formTitle">全过程索引编号：</th>
                            <td class="formValue">
                                @Html.TextBoxFor(x => x.VideoIdNo, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "NotNull", @err = "全过程索引编号", @datacol = "yes" })
                                <span style="color: Red;">*</span>
                            </td>
                            <th class="formTitle">清运垃圾（车）：</th>
                            <td class="formValue">
                                @Html.TextBoxFor(x => x.GarbageCar, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession = "NotNull", @err = "实际清运垃圾", @datacol = "yes" })
                                <span style="color: Red;">*</span>
                            </td>
                        </tr>
                        <tr>
                            <th class="formTitle">大队满意度评价</th>
                            <td class="formValue">
                                <div id="BrigadeSatisfactionDiv"></div>
                            </td>
                            <th class="formTitle">执法处满意度评价</th>
                            <td class="formValue">
                                <div id="LeaderSatisfactionDiv"></div>
                            </td>
                        </tr>
                        <tr>
                            <th class="formTitle">拆除情况描述：</th>
                            <td class="formValue" colspan="3">
                                @Html.TextArea("DismantleLetterOfPresentation", Model.DismantleLetterOfPresentation, new { @class = "txtborder", @style = "width: 781px;height:50px;", @checkexpession = "NotNull", @err = "情况说明", @datacol = "no" })
                            </td>
                        </tr>
                        
            }
                    }

                    @{
            var unIdeas = ViewData["UNFlowIdea"] as DataTable;
            if (unIdeas != null && unIdeas.Rows.Count > 0)
            {
                        <tr>
                            <td rowspan="1" class="formValue" style="width: 85px; text-align: center;">退回<br />
                                意见<br />
                            </td>
                            <td class="formValue" colspan="4">
                                <table class="casedt">
                                    @{
                foreach (DataRow row in unIdeas.Rows)
                {
                                        <tr>
                                            <td class="formTitle" width="16%" rowspan="2">@(row["Duty"])：
                                            </td>
                                            <td class="formValue">
                                                <textarea id="Remark" class="txtArea" cols="104" rows="4" readonly="readonly">@(row["Idea"])</textarea>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="formTitle" align="right">签字：<input type="text" class="casebottomtxt" style="width: 120px;" value="@(row["UserName"])"  readonly="readonly"/>
                                                日期：<input type="text" class="casebottomtxt" style="width: 120px;" value="@(Convert.ToDateTime(row["Adate"]).ToString(AppConst.DateFormat))" readonly="readonly"/>
                                            </td>
                                        </tr>
                }
                                    }
                                </table>

                            </td>
                        </tr>
            }
                    }
                    @{
            var ideas = ViewData["FlowIdea"] as DataTable;
            if (ideas != null && ideas.Rows.Count > 0)
            {
                        <tr>
                            <td rowspan="1" class="formValue" style="width: 85px; text-align: center;">拆除<br />
                                申请<br />
                                审批<br />
                                意见<br />
                            </td>
                            <td class="formValue" colspan="4">
                                <table class="casedt">
                                    @{
                foreach (DataRow row in ideas.Rows)
                {
                                        <tr>
                                            <td class="formTitle" width="16%" rowspan="2">@(row["Duty"])：
                                            </td>
                                            <td class="formValue">
                                                <textarea id="Remark" class="txtArea" cols="104" rows="4" readonly="readonly">@(row["Idea"])</textarea>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="formTitle" align="right">签字：<input type="text" class="casebottomtxt" style="width: 120px;" value="@(row["UserName"])"  readonly="readonly"/>
                                                日期：<input type="text" class="casebottomtxt" style="width: 120px;" value="@(Convert.ToDateTime(row["Adate"]).ToString(AppConst.DateFormat))" readonly="readonly"/>
                                            </td>
                                        </tr>
                }
                                    }
                                </table>
                            </td>
                        </tr>
            }
                    }
                    @{
            var ideass = ViewData["ReportFlowIdea"] as DataTable;
            if (ideass != null && ideass.Rows.Count > 0)
            {
                        <tr>
                            <td rowspan="1" class="formValue" style="width: 85px; text-align: center;">拆除<br />
                                结果<br />
                                上报<br />
                                审批<br />
                                意见<br />
                            </td>
                            <td class="formValue" colspan="4">
                                <table class="casedt">
                                    @{
                foreach (DataRow row in ideass.Rows)
                {
                                        <tr>
                                            <td class="formTitle" width="16%" rowspan="2">@(row["Duty"])：
                                            </td>
                                            <td class="formValue">
                                                <textarea id="Remark" class="txtArea" cols="104" rows="4" readonly="readonly">@(row["Idea"])</textarea>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="formTitle" align="right">签字：<input type="text" class="casebottomtxt" style="width: 120px;" value="@(row["UserName"])"  readonly="readonly"/>
                                                日期：<input type="text" class="casebottomtxt" style="width: 120px;" value="@(Convert.ToDateTime(row["Adate"]).ToString(AppConst.DateFormat))" readonly="readonly"/>
                                            </td>
                                        </tr>
                }
                                    }
                                </table>

                            </td>
                        </tr>
            }
                    }
                </table>
                <table style="width: 1050px;">
                    <tr>
                        <td style="text-align: center;">
                            @{
            if (ViewBag.BtnSave)
            {
                                <input type="button" class="btnSave" value="保　存" id="btnSave" onclick=" javascript: SaveClick(); " />
                                
                if (ViewBag.BtnApply)
                {
                                <input type="button" class="btnSave" value="@(Model.State == 0 ? "拆除申请" : "上报拆除结果")" id="btnApply" onclick="ApplyForFiled('apply', 1, 0)" style="display: none" />   
                }
            }

            if (ViewBag.BtnAppointCompany)
            {
                                <input type="button" class="btnSave" value="指定拆除公司" id="btnAppointCompany" onclick="AppointCompany()" />
            }
            if (ViewBag.BtnAgree)
            {
                                <input type="button" class="btnSave" value="同　意" id="btnAgree" onclick="ApplyForFiled('agree', 1, 0) " />
                                <input type="button" value="退  回" class="btnSave" onclick=" ApplyForFiled('disAgree', 1, 0) " />
            }
            if (ViewBag.BtnCopyLeader)
            {
                                <input type="button" class="btnSave" value="同意并抄送局领导" id="btnAgree" onclick="CopyLeader()" />
                                <input type="button" value="退  回" class="btnSave" onclick=" ApplyForFiled('disAgree', 1, 0) " />
            }
            
            
                            }
                            @if (ViewBag.btnSaveMessage && btnSave)
                            {
                                <input type="button" class="btnSave" value="保　存" id="SaveMessage" onclick=" javascript: SaveMessageClick(); " />
                            }
                            @if (ViewBag.btnSettlement && btnSettlement)
                            {
                                <input type="button" class="btnSave" value="结　算" id="SettlementSave" onclick=" javascript: SettlementClick(); " />
                            }
                            <input type="button" class="btnClose" value="关　闭" id="btnClose" onclick=" javascript: closepage(); " />
                        </td>
                    </tr>
                </table>

                @Html.HiddenFor(x => x.Id)
                @Html.HiddenFor(x => x.State)
                @Html.HiddenFor(x => x.CompanyId)
                @Html.HiddenFor(t => t.CompanyName)
                @Html.HiddenFor(x => x.DeptId)
                @Html.HiddenFor(x => x.DeptName)
                @Html.HiddenFor(x => x.CreatorId)
                @Html.HiddenFor(x => x.BrigadeSatisfaction)
                @Html.HiddenFor(x => x.LeaderSatisfaction)
                @Html.HiddenFor(x => x.CreateBy)
                @Html.HiddenFor(x => x.CreateOn)
            </div>
        }
    </div>



    <link href="~/Librarys/viewerjs1.2.0/viewer.css" rel="stylesheet" />
    <script src="~/Librarys/viewerjs1.2.0/viewer.js"></script>

</body>
</html>





<script type="text/javascript">

    $(function () {
        BindCompany();
        SetImgView();
        SetRunRowSpan('bengin1', 'end1');//拆除申请合并
        Setraty();
        AlreadyHide(true);
        setDelICoBy_State();
        ChangeDismantlingType();
    });



    //绑定单位（大队）
    function BindCompany() {
        var companyId = '@Model.CompanyId';
        getAjax("@Url.Action("GetCompanyDropList", "Company", new { area = "CommonModule" })", { controlId: "drpCompany", defaultSelId: companyId }, function (cmsg) {
            eval(cmsg);
            BindDepartment();
        });
    }
    //绑定部门（中队）
    function BindDepartment() {
        var departmentId = '@Model.DeptId';
        getAjax("@Url.Action("GetDepartmentDropList", "Department", new { area = "CommonModule" })", { companyId: $("#drpCompany").val(), controlId: "drpDepartment", defaultSelId: departmentId }, function (dmsg) {
            eval(dmsg);
        });
    }

    function CheckForm() {
        var istrue = true;
        $("#CompanyId").val($("#drpCompany").val());
        $("#CompanyName").val($("#drpCompany").find("option:selected").text());
        $("#DeptId").val($("#drpDepartment").val());
        if ($("#DeptId").val() == 'all') {
            tipCss($("#drpDepartment"), '请选择执法中队！');
            $("#drpDepartment").focus();
            istrue = false;
        } else {
            $("#DeptName").val($("#drpDepartment").find("option:selected").text());
        }
        return istrue;
    }

    //保存
    function SaveClick() {
        if (!CheckDataValid('#formmain') || !CheckForm()) {
            return false;
        }
        Loading(true, "正在提交保存…");
        window.setTimeout(function () {
            Loading(true, "正在提交数据...");
            AjaxJson('@Url.Action("AcceptClick", "IllegalConstruction")', $('#formmain').serialize(), function (data) {
                Loading(false, "正在拼了命为您加载…");
                alertDialog('数据保存成功！', 1);
                $("#btnApply").show();
            });
        }, 200);
        return false;
    }

    //保存修改信息
    function SaveMessageClick() {
        Loading(true, "正在提交保存…");
        window.setTimeout(function () {
            $.ajax({
                url: '@Url.Action("SaveMessage", "IllegalConstruction")',
                type: 'post',
                datatype: 'json',
                data: $('#formmain').serialize(),
                success: function (data) {
                    Loading(false, "正在拼了命为您加载…");
                    alertDialog('数据保存成功！', 1);
                }
            });
        }, 200);
        return false;
    }

    //已结算
    function SettlementClick() {
        Loading(true, "正在提交保存…");
        window.setTimeout(function () {
            $.ajax({
                url: '@Url.Action("Settlement", "IllegalConstruction")',
                type: 'post',
                datatype: 'json',
                data: $('#formmain').serialize(),
                success: function (data) {
                    Loading(false, "正在拼了命为您加载…");
                    alertDialog('数据保存成功！', 1);
                }
            });
        }, 200);
        return false;
    }


    //初始化图片浏览
    function SetImgView() {
        if ($('#BeforeDismantling').length > 0) {
            var viewernUp = new Viewer(document.getElementById('BeforeDismantling'), { backdrop: true });
        }
        if ($('#Dismantling').length > 0) {
            var viewernUp = new Viewer(document.getElementById('Dismantling'), { backdrop: true });
        }
        if ($('#GarbageClear').length > 0) {
            var viewernUp = new Viewer(document.getElementById('GarbageClear'), { backdrop: true });
        }
        if ($('#ListEvidence').length > 0) {
            var viewernUp = new Viewer(document.getElementById('ListEvidence'), { backdrop: true });
        }
    }

    //自动Rowspane  benginTr开始   endTr结束
    function SetRunRowSpan(benginTr, endTr) {
        if (benginTr && endTr) {
            $('#' + benginTr).attr('rowspan', $('#' + endTr).index() - ($('#' + benginTr).index() + 1));
        }
    }

    //设置满意度评价
    function Setraty() {
        var brigadeSatisfaction = '@Model.BrigadeSatisfaction';
        var leaderSatisfaction = '@Model.LeaderSatisfaction';
        $('#BrigadeSatisfactionDiv').raty({
            score: brigadeSatisfaction,
            click: function (score, evt) {
                $('#BrigadeSatisfaction').val(score);
            }, path: '/Librarys/Raty/img'
        });
        //大队初始化
        $('#LeaderSatisfactionDiv').raty({
            score: leaderSatisfaction,
            click: function (score, evt) {
                $('#LeaderSatisfaction').val(score);
            },
            path: '/Librarys/Raty/img'
        });//初始化
    }

    //已拆除隐藏
    function AlreadyHide(isfirst) {
        var rowspanNumber = $('#tdTarget').attr('rowspan');
        //已拆除申报
        if ($('#ApplicationType').val() == '00720002') {
            $('.alreadyHide').hide();
        }
        else if ($('#ApplicationType').val() == '00720001') {
            if (!isfirst) {
                $('.alreadyHide').show();
            }
        }
        SetRunRowSpan('bengin1', 'end1');//拆除申请合并
    }

    $('#ApplicationType').change(function () {
        AlreadyHide(false);
    });


    //变更拆除类型
    function ChangeDismantlingType() {
        var disType = $('#DismantlingType').val();
        if (disType == '00820001' || disType == '') {  //违法建设
            $("#trI_HouseAttr").show();
            $("#trII_HouseAttr").show();

            $("#trI_AdverAttr").hide();
            $("#trII_AdverAttr").hide();

        } else if (disType == '00820002') { //户外广告

            $("#trI_HouseAttr").hide();
            $("#trII_HouseAttr").hide();

            $("#trI_AdverAttr").show();
            $("#trII_AdverAttr").show();
        }
    }

    //设置删除    
    function setDelICoBy_State() {
        var state = '@Model.State';
        if (state) {
            if (state <= 10) {
                setDelICo('BeforeDismantling');
            }
            else {
                setDelICo('Dismantling');
                setDelICo('GarbageClear');
                setDelICo('ListEvidence');
            }
        }
    }

    //设置图片的删除图标
    function setDelICo(setId) {
        if (setId) {
            var domList = $('#' + setId + ' img');
            var width;
            var htmlStr;
            for (var i = 0; i < domList.length; i++) {
                width = $(domList[i]).width() - 16;//获取宽度               
                htmlStr = '<img src="/Content/Images/Icon16/delIcon.png" width="16" height="16" style="position: absolute;top: 0px;right: 0;">';
                $(domList[i]).parent().css('position', 'relative');
                $(domList[i]).before(htmlStr);
                $(domList[i]).prev().click(function () {
                    delImg(this);
                });
            }
        }
    }

    //删除图片
    function delImg(imgIconDom) {
        if (imgIconDom) {
            var imgDom = $(imgIconDom).next();
            confirmDialog('系统提示', '您确定需要删除这张图片？', function (cdata) {
                if (cdata) {
                    var imgSrcList = $(imgDom).attr('src').split('/');
                    var imgName = imgSrcList[imgSrcList.length - 1];
                    console.log(imgName);
                    $.get('DeleteAttach', { 'imgName': imgName }, function (data) {
                        if (data) {
                            $(imgDom).parent().parent().remove();
                        }
                    });
                }
            });
        }
    }



    //=================Start 办件审批======================


    var worklistid = '@ViewBag.WorkListId';
    function ApplyForFiled(htype, isloadOp, isFaster) {
        var formId = '@Model.Id';
        var url = '@Url.Action("IllegalConstructionWorkFlow", "WorkFlow")?formId=' + formId + '&flowName=&eType=' + htype + '&worklistId=' + worklistid + '&isloadOp=' + isloadOp + '&isFaster=' + isFaster;
        url = encodeURI(url);
        var width = 500;
        var height = 300;
        $.dialog({
            id: "WorkFlow", width: width, height: height, lock: true, max: false, resize: false, extendDrag: true,
            title: "违法拆建拆除审批",
            content: 'url:' + url,
            button: [
                {
                    name: '确 定',
                    className: 'green',
                    callback: function () {
                        top.frames["WorkFlow"].AcceptClick();
                        if (top.frames['tabs_iframe_' + "tabworklist"]) {
                            top.frames['tabs_iframe_' + "tabworklist"].btn_Refresh();
                        }
                        return true;
                    }
                }, { name: '关 闭' }
            ]
        });
    }

    //审批后调用该方法,注：所有审批返回都需要调用该方法
    //data:返回的状态,isFaster:是否是一键审批
    function ApplyReturn(data, isFaster) {
        if (data.rtState == 0 || data.rtState == 1) {
            if (isFaster == '0' || isFaster == undefined) {
                //调用进行修改案件的状态
                alertDialogCallBack(data.rtMsrg, 2, function () {
                    setTimeout(function () {
                        closepage();
                    }, 500);
                });
            } else {
                //调用进行修改案件的状态
                alertDialogCallBack(data.rtMsrg, 2, function () {
                    setTimeout(function () {
                        closepage();
                    }, 500);
                });
            }
        } else {
            alertDialog("审批过程中出现异常，请联系管理员！", -1);
        }
    }

    //案件走到哪儿
    function ShowCaseFlow() {
        var id = $("#Id").val();  //案件编号
        var caseHandle = '@Url.Action("CaseFlow", "PenaltyCase")';
        var width = 640;
        var height = 540;
        Dialog((caseHandle + "?id=" + id + "&rnd=" + Math.random()), "CaseFlow", "案件在哪里", parseInt(width), parseInt(height));
    }

    //=================End  办件审批======================

    function closepage() {
        parent.ThisCloseTab();
    }


    //指定拆除公司
    function AppointCompany() {
        var url = "@Url.Action("AppointCompany", "IllegalConstruction")?id=" + $("#Id").val() + "&rnd=" + Math.random();
        $.dialog({
            id: "AppointCompanyFrm", width: 450, height: 150, lock: true, max: false, resize: false, extendDrag: true,
            title: "指定拆除公司",
            content: 'url:' + url,
            button: [
                {
                    name: '保 存',
                    className: 'green',
                    callback: function () {
                        top.frames["AppointCompanyFrm"].SaveAppointCompany();
                        return true;
                    }
                }, { name: '关 闭' }
            ]
        });
    }

    //指定拆除公司返回
    function AppointCompanyReturn(data) {
        if (data.rtState == 0 || data.rtState == 1) {
            //调用进行修改案件的状态
            alertDialogCallBack(data.rtMsrg, 2, function () {
                setTimeout(function () {
                    window.location.reload();
                }, 500);
            });
        } else {
            alertDialog("操作出现异常，请联系管理员！", -1);
        }
    }

    //抄送局领导
    function CopyLeader() {
        var formId = '@Model.Id';
        var url = '@Url.Action("IllegalConstructionWorkFlowAndCopyLeader", "WorkFlow")?formId=' + formId + '&flowName=&eType=agree&worklistId=' + worklistid + '&isloadOp=1&isFaster=0&rnd=' + Math.random();
        url = encodeURI(url);
        var width = 500;
        var height = 390;
        $.dialog({
            id: "WorkFlow", width: width, height: height, lock: true, max: false, resize: false, extendDrag: true,
            title: "违法拆建拆除审批",
            content: 'url:' + url,
            button: [
                {
                    name: '确 定',
                    className: 'green',
                    callback: function () {
                        top.frames["WorkFlow"].AcceptClick();
                        top.frames['tabs_iframe_' + "tabworklist"].btn_Refresh();
                        return true;
                    }
                }, { name: '关 闭' }
            ]
        });
    }
</script>
