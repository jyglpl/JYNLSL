@{
    Layout = null;
    @model Yookey.WisdomClassed.SIP.Model.License.LicenseMainEntity
    
    
}
@using System.Data
@using System.Web.Mvc.Html

@using Yookey.WisdomClassed.SIP.Common
@using Yookey.WisdomClassed.SIP.Model.Com
@using Yookey.WisdomClassed.SIP.Membership
@using Yookey.WisdomClassed.SIP.Model.License


@{    
    var JeevesEntity = new LicenseJeevesEntity();
    if (ViewData["JeevesEntity"] != null)
    {
        JeevesEntity = ViewData["JeevesEntity"] as LicenseJeevesEntity;
    }
}

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>户外广告基本信息</title>

    <!--框架必需start-->
    <link href="@Url.Content("~/Content/Styles/learunui-accordion.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/Styles/learunui-framework.css")" rel="stylesheet" />
    <script src="@Url.Content("~/Librarys/jquery/jquery-1.8.2.min.js")"></script>
    <script src="@Url.Content("~/Librarys/learunui-framework.js")"></script>
    <!--框架必需end-->
    <!--布局组件start-->
    <script src="@Url.Content("~/Librarys/layout/splitter.js")"></script>
    <!--布局组件end-->

    <!--日期组件start-->
    <script src="@Url.Content("~/Librarys/datepicker/WdatePicker.js")"></script>
    <!--日期组件end-->
    <script src="@Url.Content("~/Librarys/validator/learunui-validator.js")"></script>
    <script src="@Url.Content("~/Librarys/jquery_form_min.js")"></script>

    <!--引入弹窗组件start-->
    <script src="@Url.Content("~/Librarys/lhgdialog/lhgdialog.min.js")" type="text/javascript"></script>
    <!--引入弹窗组件end-->

    <!--图片预览-->
    <script src="@Url.Content("~/Librarys/viewerjs/viewer.js")"></script>
    <link href="@Url.Content("~/Librarys/viewerjs/viewer.css")" rel="stylesheet" />
    <!--图片预览end-->

    <!--固定元素-->
    <script src="~/Librarys/stickUp/stickUp.min.js"></script>
    <!--固定元素end-->
    <style type="text/css">
        .radioLeft {
            margin-left: 10px;
        }

        .formTitle {
            width: 145px;
        }
    </style>
</head>
<body>
    <div>
        @using (Html.BeginForm("AcceptClick", "LicenseJeeves", FormMethod.Post, new { @id = "formmain", @enctype = "multipart/form-data" }))
        {
            <div style="margin-left: 5px; margin-right: 5px;">
                <table style="width: 1050px; border: 0px;" id="head">
                    <tr>
                        <td style="width: 50%; text-align: left;"></td>
                        <td style="width: 50%; text-align: right;">办件编号：
                            @Html.TextBoxFor(x => x.LicenseNo, "", new { @class = "casebottomtxt", @style = "width: 300px" })
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 50%; text-align: left;"></td>
                        <td style="width: 50%; text-align: right;">
                            <input type="button" value="办件流程" class="casebtn" onclick=" javascript: ShowCaseFlow(); " />
                            <input type="button" value="文书打印" class="casebtn" onclick=" javascript: DocPrint(); " />
                        </td>
                    </tr>
                </table>
                <table class="casedt" style="width: 1050px; border-right: 1px solid #ccc;">
                    <tr>
                        <td id="tdTarget" rowspan="5" class="formValue" style="width: 85px; text-align: center;">申<br />
                            请<br />
                            人<br />
                            信<br />
                            息<br />
                        </td>
                        <th class="formTitle">申请人类型：</th>
                        <td class="formValue">
                            <input type="radio" name="ApplicantType" id="TargetTypeG" class="radioLeft" value="00120001" @(Model.ApplicantType.Equals("00120001") ? "checked=checked" : "") onchange=" javascript:ChangeTargetType(this.value);" />
                            <label for="TargetTypeG">个人</label>
                            <input type="radio" name="ApplicantType" id="TargetTypeQ" class="radioLeft" value="00120002" @(Model.ApplicantType.Equals("00120002") ? "checked=checked" : "") onchange=" javascript:ChangeTargetType(this.value);" />
                            <label for="TargetTypeQ">企业</label>
                        </td>
                        <th class="formTitle">证件类型：</th>
                        <td class="formValue">
                            @Html.DropDownListFor(x => x.PaperType, (ViewData["PaperTypes"] as IEnumerable<SelectListItem>), new { @class = "txtselectN", @style = "width: 303px" })
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle">申请人证照编号：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.PaperCode, "", new { @class = "txtborder", @style = "width: 300px;" })
                            <label id="ForPaperCode"><img src="@Url.Content("~/Content/Images/Icon16/page_white_magnify.png")" style="vertical-align:middle; " width="27" height="27"/></label>
                        </td>
                        <th class="formTitle">申请人：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.ApplicantName, "", new { @style = "width: 300px;", @class = "txtborder", @checkexpession="NotNull",@err="申请人",@datacol="no"})
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle">单位地址：<span style="color: Red;" id="Address"></span></th>
                        <td class="formValue" colspan="3">
                            @Html.TextBoxFor(x => x.CompanyAddress, "", new { @class = "txtborder", @style = "width: 781px;",@checkexpession="NotNull",@err="单位地址",@datacol="no" })
                        </td>
                    </tr>
                    <tr id="QyShow">
                        <th class="formTitle">法定代表人：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.LegalPersonName, "", new { @style = "width: 300px;", @class = "txtborder" })
                        </td>
                        <th class="formTitle">身份证件号：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.LegalPersonId, "", new { @style = "width: 300px;", @class = "txtborder" })
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle">联系人：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.LinkMan, "", new { @class = "txtborder", @style = "width: 300px;",@checkexpession="NotNull",@err="联系人",@datacol="no" })
                        </td>
                        <th class="formTitle">联系电话：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.LinkTel, "", new { @class = "txtborder", @style = "width: 300px;" ,@checkexpession="NotNull",@err="联系电话",@datacol="no"})
                        </td>
                    </tr>
                    @*<tr>
                        <th class="formTitle">手机：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.LinkMobile, "", new { @class = "txtborder", @style = "width: 300px;" })
                        </td>
                        <th class="formTitle">传真：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.Fax, "", new { @class = "txtborder", @style = "width: 300px;" })
                        </td>
                    </tr>*@
                    <tr>
                        <th class="formTitle">邮编：<span style="color: Red;" id="spanAddress"></span></th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.ZipCode, "", new { @class = "txtborder", @style = "width: 300px;" })
                        </td>
                        <th class="formTitle">电子邮件：</th>
                        <td class="formValue">
                            @Html.TextBoxFor(x => x.Email, "", new { @class = "txtborder", @style = "width: 300px;" })
                        </td>
                    </tr>

   <tr>
                        <td rowspan="7" class="formValue" style="width: 85px; text-align: center;">申<br />
                            请<br />
                            登<br />
                            记<br />
                            事<br />
                            项
                        </td>
                        <th class="formTitle">占道原因：<span style="color: Red;"></span></th>
                        <td class="formValue" colspan="3">
                            @Html.TextArea("JeevesContent", JeevesEntity.Content, new { @class = "txtborder", @style = "width: 781px;height:50px;", })
                        </td>                      
                    </tr>
                    <tr>
                        <th class="formTitle">占道面积：<span style="color: Red;"></span></th>
                        <td class="formValue" colspan="3">                            
                            @Html.TextBox("JeevesArea", JeevesEntity.JeevesArea, new { @class = "txtborder", @style = "width: 150px;" })
                          @*  长度：
                            @Html.TextBox("JeevesLength", JeevesEntity.JeevesLength, new { @class = "txtborder", @style = "width: 50px;" })
                            X宽度：
                            @Html.TextBox("JeevesWidth", JeevesEntity.JeevesWidth, new { @class = "txtborder", @style = "width: 50px;" })*@
                        </td>
                    </tr>                                                            
                    <tr>
                        <th class="formTitle">占道地点：<span style="color: Red;"></span></th>
                        <td class="formValue" colspan="3">
                            @Html.TextBox("JeevesAdress", JeevesEntity.JeevesAdress, new { @class = "txtborder", @style = "width: 500px;",@checkexpession="NotNull",@err="占道地点",@datacol="no" })
                        </td>
                    </tr>                   
                    <tr>
                        <th class="formTitle">占道时间：<span style="color: Red;"></span></th>
                        <td class="formValue" colspan="3">
                            @Html.TextBox("JeevesStartTime", JeevesEntity.JeevesStartTime, new { @class = "txtborder", @style = "width: 150px;", @onfocus = "WdatePicker({dateFmt:'yyyy-MM-dd'})", Value = JeevesEntity.JeevesStartTime.Year < 2000 ? "" : JeevesEntity.JeevesStartTime.ToString(AppConst.DateFormat) })
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;至&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            @Html.TextBox("JeevesEndTime", JeevesEntity.JeevesEndTime, new { @class = "txtborder", @style = "width: 150px;", @onfocus = "WdatePicker({dateFmt:'yyyy-MM-dd'})", Value = JeevesEntity.JeevesEndTime.Year < 2000 ? "" : JeevesEntity.JeevesEndTime.ToString(AppConst.DateFormat) })                           
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle"></th>
                        <td colspan="3">
                           @{
            var setUpCycleDetails = ViewData["SetUpCycleDetails"] as IList<ComResourceEntity>;
            if (setUpCycleDetails != null && setUpCycleDetails.Any())
            {
                foreach (var entity in setUpCycleDetails)
                {
                    var ischecked = entity.Id.Equals(JeevesEntity.SetUpCycleDetails) ? "checked=checked" : "";
                                <span class="item">
                                    <input type="radio" name="SetUpCycleDetails" class="radioLeft" @ischecked id="@entity.Id" value="@entity.Id" />
                                    <label id="lab_@entity.Id" for="@entity.Id">@entity.RsKey</label>
                                </span>
                }
            }
                            }
                            @Html.TextBox("SetUpCycleOther", "", new { @class = "txtborder", @style = "width: 300px;margin-left:10px;" })
                        </td>
                    </tr>                      
                    <tr>
                        <td class="formTitle">备注：</td>
                        <td class="formValue" colspan="3">
                            @Html.TextAreaFor(x => x.TestRemark, new { @class = "txtborder", @style = "width: 781px;height:50px;" })
                        </td>
                    </tr>
                    <tr>
                        <td class="formTitle">是否测试办件：</td>
                       <td class="formValue" colspan="3">
                            <input type="radio" name="IsTest" id="rdocsbjY" class="radioLeft" @(Model.IsTest == 1 ? "checked=checked" : "") value="1" />
                            <label for="rdocsbjY">是</label>
                            <input type="radio" name="IsTest" id="rdocsbjN" class="radioLeft"  @(Model.IsTest == 0 ? "checked=checked" : "") value="0" />
                            <label for="rdocsbjN">否</label>
                        </td>
                    </tr>

                    <tr>
                        <td @*rowspan="3"*@ class="formValue" style="width: 85px; text-align: center;">受<br />
                            理<br />
                            信<br />
                            息<br />                                        
                        <td class="formTitle">处办街道、辖区<br />
                            管理办：
                        </td>
                        <td class="formValue" colspan="3">
                            @Html.DropDownListFor(x => x.Area, (ViewData["Companys"] as IEnumerable<SelectListItem>), new { @class = "txtselectN", @style = "width: 303px",@checkexpession="NotNull",@err="处办街道、辖区管理办",@datacol="yes" })
                        </td>             
                    </tr>
                   @* <tr>
                        <td class="formTitle">承诺日期：</td>
                        <td class="formValue" colspan="3">
                            @Html.TextBoxFor(x => x.PromiseStartDate, "", new { @class = "txtborder", @style = "width: 150px;", @onfocus = "WdatePicker({dateFmt:'yyyy-MM-dd'})",@disabled="disabled", @Value = Model.PromiseStartDate.ToString(AppConst.DateFormat) })
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;至&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            @Html.TextBoxFor(x => x.PromiseEndDate, "", new { @class = "txtborder", @style = "width: 150px;", @onfocus = "WdatePicker({dateFmt:'yyyy-MM-dd'})",@disabled="disabled", @Value = Model.PromiseEndDate.ToString(AppConst.DateFormat) })

                        </td>
                    </tr>*@
                   

                    @{
            if (ViewBag.InquestPanel)
            {
                        <!--现场勘察开始-->
                        <tr>
                            <td rowspan="4" class="formValue" style="width: 85px; text-align: center;">现<br />
                                场<br />
                                勘<br />
                                验<br />
                                信<br />
                                息
                            </td>
                            <td class="formTitle">地址、门牌号</td>
                            <td class="formValue" colspan="3">
                                @Html.TextBox("InquestAdress", JeevesEntity.InquestAdress, new { @class = "txtborder", @style = "width: 300px;" })
                            </td>                            
                        </tr> 
                        <tr>
                        <th class="formTitle">占道面积（单<br/>位：米）：<span style="color: Red;"></span></th>
                        <td class="formValue" colspan="3">
                            长度：
                            @Html.TextBox("InquestLength", JeevesEntity.InquestLength, new { @class = "txtborder", @style = "width: 50px;" })
                            X宽度：
                            @Html.TextBox("InquestWidth", JeevesEntity.InquestWidth, new { @class = "txtborder", @style = "width: 50px;" })
                        </td>
                        </tr>                       
                        <tr>
                            <td class="formTitle">现场勘验照片</td>
                            <td class="formValue" colspan="3">
                                <!-- 现场勘察照片-->
                                @Html.Action("LicenseFilesTab", "PenaltyCaseFile", new { controlId = "InquestPhotos", resourceId = Model.Id, fileType = "Prospect", isupload = "false" })
                            </td>
                        </tr>
                        <tr>
                            <td class="formTitle">是否符合申请尺寸</td>
                            <td class="formValue" colspan="3">
                                   @{
                var IsState = ViewData["IsState"] as IList<ComResourceEntity>;
                if (IsState != null && IsState.Any())
                {
                    foreach (var entity in IsState)
                    {
                        var ischecked = entity.Id.Equals(JeevesEntity.IsInquest) ? "checked=checked" : "";
                                <span class="item">
                                    <input type="radio" name="IsInquest" class="radioLeft" @ischecked id="IsInquest_@entity.Id" value="@entity.Id" />
                                    <label for="IsInquest_@entity.Id">@entity.RsKey</label>
                                </span>
                    }
                }
                            }
                            </td>
                        </tr>
                        <!--现场勘结束-->
            }
                    }
                    @{
            if (ViewBag.AcceptancePanel)
            {
                        <!--现场验收开始-->
                        <tr>
                            <td rowspan="3" class="formValue" style="width: 85px; text-align: center;">现<br />
                                场<br />
                                验<br />
                                收<br />
                                信<br />
                                息
                            </td>                        
                        <th class="formTitle">验收占道面积（单<br/>位：米）：<span style="color: Red;"></span></th>
                        <td class="formValue" colspan="3">
                            长度：
                            @Html.TextBox("CheckLength", JeevesEntity.CheckLength, new { @class = "txtborder", @style = "width: 50px;" })
                            X宽度：
                            @Html.TextBox("CheckWidth", JeevesEntity.CheckWidth, new { @class = "txtborder", @style = "width: 50px;" })
                        </td>                        
                        </tr>                        
                        <tr>
                            <td class="formTitle">现场检查近景照片</td>
                            <td class="formValue" colspan="3">
                                <!-- 现场检查近景照片-->
                                @Html.Action("LicenseFilesTab", "PenaltyCaseFile", new { controlId = "AcceptancePhotos", resourceId = Model.Id, fileType = "Check", isupload = "false" })
                            </td>
                        </tr>
                        <tr>
                            <td class="formTitle">是否符合申请尺寸</td>
                            <td class="formValue" colspan="3">
                                   @{
                var IsState = ViewData["IsState"] as IList<ComResourceEntity>;
                if (IsState != null && IsState.Any())
                {
                    foreach (var entity in IsState)
                    {
                        var ischecked = entity.Id.Equals(JeevesEntity.IsCheck) ? "checked=checked" : "";
                                <span class="item">
                                    <input type="radio" name="IsCheck" class="radioLeft" @ischecked id="IsCheck_@entity.Id" value="@entity.Id" />
                                    <label for="IsCheck_@entity.Id">@entity.RsKey</label>
                                </span>
                    }
                }
                            }
                            </td>
                        </tr>
                        <!--现场验收结束-->
            }
                    }
                    <tr>
                        <td rowspan="1" class="formValue" style="width: 85px; text-align: center;">申<br />
                            请<br />
                            材<br />
                            料<br />
                            目<br />
                            录
                        </td>
                        <td class="formValue" colspan="4">
                            @Html.Action("LicenseView", "LicenseAttach", new { licenseId = Model.Id, itemCode = Model.ItemCode })
                        </td>
                    </tr>

                    @{
            var ideas = ViewData["FlowIdea"] as DataTable;
            if (ideas != null && ideas.Rows.Count > 0)
            {
                        <tr>
                            <td rowspan="1" class="formValue" style="width: 85px; text-align: center;">审<br />
                                批<br />
                                意<br />
                                见
                            </td>
                            <td class="formValue" colspan="4">
                                <table class="casedt">
                                    @{
                foreach (DataRow row in ideas.Rows)
                {
                                        <tr>
                                            <td class="formTitle" width="16%" rowspan="2">@(row["Duty"])：
                                            </td>
                                            <td class="formValue">
                                                <textarea id="Remark" class="txtArea" cols="104" rows="4" readonly="readonly">@(row["Idea"])</textarea>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="formTitle" align="right">签字：<input type="text" class="casebottomtxt" style="width: 120px;" value="@(row["UserName"])"  readonly="readonly"/>
                                                日期：<input type="text" class="casebottomtxt" style="width: 120px;" value="@(Convert.ToDateTime(row["Adate"]).ToString(AppConst.DateFormat))" readonly="readonly"/>
                                            </td>
                                        </tr>
                }
                                    }
                                </table>

                            </td>
                        </tr>
            }
                    }
                     <tr>
                        <td class="formValue">综合审批意见：</td>
                        <td class="formValue">
                            @Html.TextAreaFor(x => x.ClosedIdea, new { @class = "txtborder", @style = "width: 781px;height:50px;", @checkexpession = "NotNull", @err = "设置地点", @datacol = "no" })
                        </td>
                    </tr>
                </table>

                <table style="width: 1050px;">
                    <tr>
                        <td style="text-align: center;">

                            @if (ViewBag.BtnSave)
                            {
                                <input type="button" class="btnSave" value="保　存" id="btnSave" onclick=" javascript: SaveClick(); " />
                            }
                            @if (ViewBag.BtnAccept)
                            {
                                <input type="button" class="btnSave" value="受　理" id="btnAccept" onclick=" javascript: AcceptClick(); " style="display: none" />
                            }
                            @if (ViewBag.BtnSubmit)
                            {
                                @*<input type="button" class="btnSave" value="提　交" onclick="ApplyForFiled('agree', 1, 0) " />*@
                                <input type="button" class="btnSave" value="转 派" onclick="SelectUsers() " />
                            }
                            @if (ViewBag.BtnApply)
                            {
                                if (Model.State == 10)
                                {
                                <input type="button" class="btnSave" value="发　送" id="btnApply" onclick=" ApplyForFiled('apply', 1, 0) " />
                                }
                                else if (Model.State < 10)
                                {
                                <input type="button" class="btnSave" value="发　送" id="btnApply" onclick=" ApplyForFiled('apply', 1, 0) " style="display: none" />
                                }
                            }
                            @if (ViewBag.BtnAgree)
                            {
                                <input type="button" value='@ViewBag.btnAgreeName' class="btnSave" onclick=" ApplyForFiled('agree', 1, 0) "/>
                            }
                            @if (ViewBag.BtnDisAgree)
                            {
                                <input type="button" value="退  回" class="btnSave" onclick=" ApplyForFiled('disAgree', 1, 0) " />
                            }
                            @if (ViewBag.BtnNext)
                            {
                                <input type="button" value="下一步（验收、发证通知）" class="btnSave" onclick=" NextSetNo() " />
                            }
                            @if (ViewBag.BtnClosed)
                            {
                                <input type="button" value="办　结" class="btnSave" id="btnClose" onclick=" LicenseColsed() " />
                            }
                             @if (ViewBag.BtnBackWindows)
                             {
                                <input type="button" value="退回窗口" class="btnSave" id="btnBackWindows" onclick=" LicenseBack() " />
                             }
                                                        
                            @Html.HiddenFor(x => x.Id)
                            @Html.HiddenFor(x => x.ItemCode)
                            @Html.HiddenFor(x => x.PromiseStartDate)
                            @Html.HiddenFor(x => x.PromiseEndDate)
                            @Html.HiddenFor(x => x.AreaAgentId)
                            @Html.HiddenFor(x => x.AreaAgentName)
                            @Html.HiddenFor(x => x.AreaAuditorId)
                            @Html.HiddenFor(x => x.AreaAuditorName)
                            @Html.HiddenFor(x => x.AcceptanceId)
                            @Html.HiddenFor(x => x.AcceptanceName)
                            @Html.HiddenFor(x => x.State)
                            @Html.HiddenFor(x => x.GPSLat)
                            @Html.HiddenFor(x => x.GPSLng)
                            @Html.HiddenFor(x => x.BaiduLat)
                            @Html.HiddenFor(x => x.BaiduLng)
                            @Html.HiddenFor(x => x.SurveyDate)
                            @Html.HiddenFor(x => x.AcceptanceCheck)
                            @Html.HiddenFor(x => x.AcceptanceDate)
                            @Html.HiddenFor(x => x.LicenseSetNo)
                            @Html.HiddenFor(x => x.RowStatus)
                        </td>
                    </tr>
                </table>
            </div>
        }
    </div>
</body>
</html>


<script type="text/javascript">

    $(function () {

        InitFormInput();
        ChangeTargetType($("input[name='TargetType']:checked").val());

        SetImgView();
        setRadio();
        //打开搜索
        $("#ForPaperCode").click(function () {
            Open_ApplicantInfo();
        });
    });


    function NextSetNo() {
        worklistid = '';
        ApplyForFiled('apply', 1, 0);        
        $.get('@Url.Action("UpLicenseSetNo", "LicenseMain")', { licesenId: '@Model.Id' }, function () {

        });
    }

    //个人默认切换
    function setRadio() {
        if ($('input:radio[name="ApplicantType"]:checked').val() == '00120002') {
            ChangeTargetType('00120002');
        }
    }

    jQuery(function ($) {
        $(document).ready(function () {
            $('#head').stickUp();
        });
    });

    //初始化图片浏览
    function SetImgView() {
        if ($('#AcceptancePhotos').length > 0) {
            var viewernUp = new Viewer(document.getElementById('AcceptancePhotos'), { backdrop: true });
        }
        if ($('#InquestPhotos').length > 0) {
            var viewernDown = new Viewer(document.getElementById('InquestPhotos'), { backdrop: true });
        }
    }

    /* 初始化控 */
    function InitFormInput() {
        $("input[placeholder]").addClass('placeholder').focus(function () {
            if ($(this).val() == this.defaultValue) {
                $(this).val('');
                $(this).removeClass('placeholder');
            }
        }).blur(function () {
            if ($(this).val() == '') {
                $(this).val(this.defaultValue);
                $(this).addClass('placeholder');
            }
        });

        $('input[name=IsInquest]').attr("disabled", true);
        $('input[name=IsCheck]').attr("disabled", true);
        $('#TestRemark').val('此批件自审批之日起三月内设置有效，逾期重新审批');        
    }

    //更改当事人类型
    function ChangeTargetType(targetType) {
        if (targetType == "00120002") {     //法人
            $('#QyShow').show();
            $('#TargetPaperType').empty();
            $("#tdTarget").attr("rowSpan", 6);
            $("#PaperType").val('00550001');

        } else {
            $("#spanCompany").hide();
            $('#QyShow').hide();
            $("#spanUserName").show();
            $("#trcompcode1").hide();
            $("#trcompcode2").hide();
            $("#tdTarget").attr("rowSpan", 5);
            $("#PaperType").val('00550004');
        }
    }

    //添加规格
    function addSpec(clickedButton) {

        var tempfacility = $("#tempfacility").html();

        var tempRow = "<table class=\"lawbox\" id=\"lawbox$i\">" +
                                    "<tr>" +
                                        "<td>店招#：</td>" +
                                        "<td>宽：</td>" +
                                        "<td><input type=\"text\" name=\"txtwidth\" class=\"txtborder\" style=\"width: 80px;\" /></td>" +
                                        "<td>X高：</td>" +
                                        "<td><input type=\"text\" name=\"txtheight\" class=\"txtborder\" style=\"width: 80px;\" /></td>" +
                                        "<td>X外挑：</td>" +
                                        "<td><input type=\"text\" name=\"txtLogn\" class=\"txtborder\" style=\"width: 80px;\" /></td>" +
                                        "<td style=\"padding-left: 20px;\">设施类型：</td><td>" +
                                            "<select class=\"txtselectN\" name=\"FacilityType\" style=\"width: 100px;\">" + tempfacility +
                                            "</select></td>" +
                                        "<td style=\"padding-left: 20px;\">其他类型：</td>" +
                                        "<td>" +
                                            "<input type=\"text\" name=\"txtothertype\" class=\"txtborder\" style=\"width: 80px;\" /></td>" +
                                        "<td class=\"w-30\"><a class=\"btn icon-plus\" onclick=\"addSpec(this)\" href=\"javascript:void();\"></a></td>" +
                                        "<td class=\"w-30\"><a class=\"btn icon-remove\" onclick=\"delSpec(this)\" href=\"javascript:void();\"></a></td>" +
                                    "</tr>" +
                                "</table>";

        tempRow = tempRow.replace('$i', $('.lawbox').size() + 1);
        tempRow = tempRow.replace('店招#', '店招#' + ($('.lawbox').size() + 1));
        $(".lawform").append(tempRow);
        $(".lawbox").trigger("create");
    }

    //删除规格
    function delSpec(clickedButton) {
        if ($('.lawbox').size() == 1) return;
        $(clickedButton).closest('.lawbox').remove();
    }

    //设置时间默认2年
    $('#SetUpStartDate').blur(function () {
        var startDate = $('#SetUpStartDate').val();
        var dateArty = startDate.split('-');
        if (startDate && dateArty.length >= 3) {
            $('#SetUpEndDate').val(parseInt(dateArty[0]) + 2 + '-' + dateArty[1] + '-' + (dateArty[2] - 1));
        }

    });

    function closepage() {
        parent.ThisCloseTab();
    }


    //保存事件
    function SaveClick() {
        if (!CheckDataValid('#formmain')) {
            return false;
        }
        Loading(true, "正在提交保存…");
        window.setTimeout(function () {
            var options = {
                type: 'multipart/form-data',
                dataType: 'json',
                beforeSubmit: function () {

                },
                success: function (data) {
                    Loading(false, "正在拼了命为您加载…");
                    alertDialog('数据保存成功！', 1);

                    $("#btnSave").hide();
                    $("#btnAccept").show();
                }
            };
            $("#formmain").ajaxSubmit(options);
        }, 200);
        return false;
    };


    //办件受理操作
    function AcceptClick() {
        Loading(true, "正在提交数据...");
        AjaxJson('@Url.Action("LicenseAcceptance", "LicenseApproval")', {
            licenseId: '@Model.Id',
            acceptType: 'agree'
            }, function (data) {
                alertDialog(data.rtMsrg, 1);
                if (data.rtState == 1) {
                    $("#btnAccept").hide();
                    $("#btnApply").show();
                }
            });
    }

    //办件办结操作
    function LicenseColsed() {
        Loading(true, "正在提交数据...");
        AjaxJson('@Url.Action("LicenseClosed", "LicenseApproval")', {
            licenseId: '@Model.Id'
        }, function (data) {
            alertDialog(data.rtMsrg, 1);
            if (data.rtState == 1) {
                $("#btnClose").hide();
            }
        });
        
       @* var licenseId = '@Model.Id';
        var url = '@Url.Action("SetIdea", "LicenseMain")?licenseId=' + licenseId + '&rnd=' + Math.random();
        url = encodeURI(url);
        var width = 450;
        var height = 250;
        $.dialog({
            id: "LicenseSetIdea", width: width, height: height, lock: true, max: false, resize: false, extendDrag: true,
            title: "办结意见",
            content: 'url:' + url,
            button: [
                {
                    name: '确 定',
                    className: 'green',
                    callback: function () {
                        top.frames["LicenseSetIdea"].AcceptClick();
                        $("#btnClose").hide();
                        return true;
                    }
                }, { name: '关 闭' }
            ]
        });*@
    }


    //退回窗口
    function LicenseBack() {
        var licenseId = '@Model.Id';
        var workListId = '@ViewBag.WorkListId';
        var url = '@Url.Action("BackWindow", "LicenseMain")?licenseId=' + licenseId + '&workListId=' + workListId + '&rnd=' + Math.random();
        url = encodeURI(url);
        var width = 450;
        var height = 250;
        $.dialog({
            id: "BackWindow", width: width, height: height, lock: true, max: false, resize: false, extendDrag: true,
            title: "退回窗口",
            content: 'url:' + url,
            button: [
                {
                    name: '确 定',
                    className: 'green',
                    callback: function () {
                        top.frames["BackWindow"].AcceptClick();
                        $("#btnBackWindows").hide();
                        return true;
                    }
                }, { name: '关 闭' }
            ]
        })
    }

        //更新审批已经单独方法
        function UpCloseIdea() {
            $.post('@Url.Action("UpCloseIdea", "LicenseMain")', { licesenId: '@Model.Id', idea: $('#ClosedIdea').val() }, function () {

            });
        }


        //=================Start 办件审批======================


        var worklistid = '@ViewBag.WorkListId';
        function ApplyForFiled(htype, isloadOp, isFaster) {
            var formId = '@Model.Id';
            if (worklistid && htype == 'apply') {
                htype = 'agree';
            }
            var url = '@Url.Action("LicenseWorkFlow", "WorkFlow")?formId=' + formId + '&flowName=&eType=' + htype + '&worklistId=' + worklistid + '&isloadOp=' + isloadOp + '&isFaster=' + isFaster;
            url = encodeURI(url);
            var width = 500;
            var height = 300;
            $.dialog({
                id: "WorkFlow", width: width, height: height, lock: true, max: false, resize: false, extendDrag: true,
                title: "临时占道审批",
                content: 'url:' + url,
                button: [
                    {
                        name: '确 定',
                        className: 'green',
                        callback: function () {
                            top.frames["WorkFlow"].AcceptClick();
                            if (top.frames['tabs_iframe_' + "tabworklist"]) {
                                top.frames['tabs_iframe_' + "tabworklist"].btn_Refresh();
                            }
                            UpCloseIdea();
                            return true;
                        }
                    }, { name: '关 闭' }
                ]
            });
        }

        //审批后调用该方法,注：所有审批返回都需要调用该方法
        //data:返回的状态,isFaster:是否是一键审批
        function ApplyReturn(data, isFaster) {
            if (data.rtState == 0 || data.rtState == 1) {
                if (isFaster == '0' || isFaster == undefined) {
                    //调用进行修改案件的状态
                    alertDialogCallBack(data.rtMsrg, 2, function () {
                        setTimeout(function () {
                            //location.reload();
                            closepage();
                        }, 500);
                    });
                } else {
                    //调用进行修改案件的状态
                    alertDialogCallBack(data.rtMsrg, 2, function () {
                        setTimeout(function () {
                            //location.reload();
                            closepage();
                        }, 500);
                    });
                }
            } else {
                alertDialog("审批过程中出现异常，请联系管理员！", -1);
            }
        }

        //案件走到哪儿
        function ShowCaseFlow() {
            var id = $("#Id").val();  //案件编号
            var caseHandle = '@Url.Action("CaseFlow", "PenaltyCase")';
            var width = 640;
            var height = 540;
            Dialog((caseHandle + "?id=" + id + "&rnd=" + Math.random()), "CaseFlow", "案件在哪里", parseInt(width), parseInt(height));
        }

        //=================End  办件审批======================

        // 跳转到文书打印页面
        function DocPrint() {
            var url = '@Url.Action("DocReportPrint", "LicenseOutDoor")';
            var width = $(window).width() * 0.7;
            var height = $(window).height() * 0.9;
            var id = $("#Id").val();  //案件编号
            Dialog((url + "?id=" + id), "DocReportPrint", "文书打印", width, height);
        }


        //打开搜索
        function Open_ApplicantInfo() {
            var url = '@Url.Action("SearchPaperCodeList", "LicenseApproval")' + '?rnd=' + Math.random();
            $.dialog({
                id: "PaperCodeList", width: 850, height: 470, lock: true, max: false, resize: false, extendDrag: true,
                title: "申请人检索",
                content: 'url:' + url,
                button: [
                    {
                        name: '确 定',
                        className: 'green',
                        callback: function () {
                            top.frames["PaperCodeList"].AcceptClick();
                            return true;
                        }
                    }, { name: '关 闭' }
                ]
            });
        };

        //搜索后回调
        function Update_ApplicantInfo(applicantType, paperType, paperCode, applicantName, companyAddress, legalPersonName, legalPersonId, linkMan, linkTel, zipCode, email, fax) {
            if (applicantType == '00120001') {
                $("#TargetTypeG").attr("checked", true);
            }
            else if (applicantType == '00120002') {
                $("#TargetTypeQ").attr("checked", true);
            }

            $("#PaperType").val(paperType);
            $("#PaperCode").val(paperCode);
            $("#ApplicantName").val(applicantName);
            $("#CompanyAddress").val(companyAddress);
            $("#LegalPersonName").val(legalPersonName);
            $("#LegalPersonId").val(legalPersonId);
            $("#LinkMan").val(linkMan);
            $("#LinkTel").val(linkTel);
            $("#ZipCode").val(zipCode);
            $("#Email").val(email);
            $("#Fax").val(fax);
        };

        //转派
        function SelectUsers() {

            var url = '@Url.Action("SelectUser", "LicenseMain")' + '?licenseId=' + '@Model.Id';
            var width = 500;
            var height = 380;
            $.dialog({
                id: "SelectUsers", width: width, height: height, lock: true, max: false, resize: false, extendDrag: true,
                title: "选择人员",
                content: 'url:' + url + '&rnd=' + Math.random(),
                button: [
                    {
                        name: '保存',
                        className: 'green',
                        callback: function () {
                            top.frames["SelectUsers"].SaveFlightUsers();
                            return;
                        }
                    },
                    {
                        name: '关 闭'
                    }
                ]
            });
        }    
</script>



